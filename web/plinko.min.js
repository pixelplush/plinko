let e="Pixel Plinko",t={},a={},o="";function n(e){return Math.floor(Math.random()*Math.floor(e))}function r(){let t=Object.keys(p).length;fetch(`https://api.instafluff.tv:8082/report?game=${e}&channel=${a.channel}&players=${t}&persist=true`).then(e=>e.json()).then(e=>{0===e.status&&console.log("Error:",e.message)})}window.setupGame=function(n,r,i){e=n,t=r,a=i,o=t.path||"",a.clouds=void 0===a.clouds||null===a.clouds?!a.overlay:a.clouds},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:g,update:b,channel:a.channel,username:a.oauth?a.channel:void 0,password:a.oauth,onCommand:l,onChat:c,wallTop:!1,wallBottom:!0,wallLeft:!0,wallRight:!0,gravity:{x:0,y:1}}),ComfyJS.onConnected=(e,o,s)=>{s&&(function(){if(d=Unicorn.AddBacklay("target","target",184+n(1552),1033,{scale:{x:2,y:2}}),d.anchor.set(.5),a.clouds)for(let e=0;e<11;e++){i++;let e=t.clouds[n(t.clouds.length)],o=Unicorn.AddOverlay("cloud_"+i,e,n(1920),n(500),{scale:{x:3,y:3}});o.alpha=a.overlay?.5:.9,o.anchor.set(.5),o.speed=.01+.1*Math.random(),o.zIndex=o.speed,m.push(o)}a.hideTilDrop&&(m.forEach(e=>e.visible=!1),d.visible=!1)}(),setInterval(()=>{r()},6e4),r())}}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();let i=0,s=!0;function l(e,o,r,l,c){if(!l.broadcaster&&!l.mod||"resetplinko"!==o&&"resetboing"!==o||location.reload(),(l.broadcaster||l.mod)&&"testplinko"===o)for(var f=0;f<50;f++)i++,u("test"+i,"test_"+i,c.userColor||"#ffffff",Object.keys(t.characters)[n(Object.keys(t.characters).length)]);if("plink"===o||"plinko"===o||"boing"===o||"boingboing"===o){s&&a.hideTilDrop&&(s=!1,m.forEach(e=>e.visible=!0),d.visible=!0);const t=twemoji.parse(r,{assetType:"png"});!c.messageEmotes&&t.length>0?u(e,e,c.userColor||"#ffffff",r,"",t[0].url):u(e,e,c.userColor||"#ffffff",r,c.messageEmotes?Object.keys(c.messageEmotes)[0]:"")}}function c(e,t,a,o,n){}let f=null,d=null,p={},y={},h={},m=[];function u(e,a,o="#ffffff",r,i="",s=""){if(!p[e]){let d=null,m=tinycolor(o);if(i){if(!y[i]){y[i]=!0;var l=`https://static-cdn.jtvnw.net/emoticons/v1/${i}/2.0`;return Unicorn.Load(`emote_${i}`,l),void setTimeout(()=>{u(e,a,o,r,parachute,i)},500)}d=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${i}`],loop:!0}},x:n(1920),y:-100-n(50),z:100,radius:36}),d.endImage=`emote_${i}`,d.endScale=1.2}else if(s){if(!h[s])return h[s]=!0,Unicorn.Load(`emoji_${s}`,s),void setTimeout(()=>{u(e,a,o,r,parachute,i)},500);d=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${s}`],loop:!0}},x:n(1920),y:-100-n(50),z:100,radius:36}),d.endImage=`emoji_${s}`,d.endScale=1}else if(t.characters[r]||(r=t.playable[Math.floor(t.playable.length*Math.random())]),d=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${r}_${e}`),loop:!0}},x:n(1920),y:-100-n(50),z:100,radius:36}),d.endImage=`${r}_0`,d.endScale=3,"boybear"===r||"girlbear"===r){var c=PIXI.utils.string2hex(m.brighten(50).toHexString());d.animations.front.tint=c}let g=Unicorn.AddText("name_"+e,a,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:o,lineJoin:"round",stroke:m.getLuminance()<.6?"#ffffff":"#000000",strokeThickness:6});g.anchor.set(.5),d.rotationOffset=Math.random()*Math.PI,p[e]={player:d,label:g},f&&clearTimeout(f),f=setTimeout(()=>{location.reload()},9e4)}}function g(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${o}/assets/${t.bg}.png`),!a.overlay){var e=Unicorn.AddBacklay("map","map",0,0);e.scale.x=3,e.scale.y=3}Unicorn.Load("wall",`${o}/assets/${t.wall}.png`),Unicorn.Load("peg",`${o}/assets/${t.peg}.png`),Unicorn.Load("star",`${o}/assets/${t.star}.png`),Object.keys(t.characters).forEach(e=>{for(let a=0;a<10;a++){let n=t.characters[e];Unicorn.Load(`${e}_${a}`,`${o}/assets/characters/${e}/${n}_front/${n}_front${a+1}.png`)}}),t.clouds.forEach(e=>Unicorn.Load(e,`${o}/assets/${e}.png`));for(let e=0;e<4;e++)for(let t=0;t<13;t++){let a=Unicorn.AddObject(`peg_${e}-${t}`,{type:"circle",x:136*t+(e%2>0?160:98),y:200*e+240,radius:27,scale:{x:3,y:3},sprite:"peg",isStatic:!0,density:1/0,friction:1,frictionStatic:.5,frictionAir:.01,onEnter:(e,t)=>{e.startsWith("player_")}});a.restitution=1.25,a.mass=1/0,a.inverseMass=0}for(let e=0;e<4;e++){Unicorn.AddObject(`wall_${e}`,{type:"rectangle",x:1920*e/5+384-8,y:1020,width:12,height:120,scale:{x:3,y:3},sprite:"wall",isStatic:!0})}Unicorn.AddBacklay("star","star",960,1e3,{scale:{x:3,y:3}}).anchor.set(.5),Matter.Events.on(physics,"beforeUpdate",(function(e){for(var t in p)Matter.Body.setVelocity(p[t].player,{x:Math.max(Math.min(p[t].player.velocity.x,30),-30),y:Math.max(Math.min(p[t].player.velocity.y,30),-30)})}))}function b(e,t){for(var a in p)p[a].isLanded,p[a].player.position.y>1060&&(p[a].isLanded=!0),p[a].label.position.x=p[a].player.position.x,p[a].label.position.y=p[a].player.position.y-60;m.forEach((e,a)=>{e.x-=t*e.speed,e.x+e.width/2<=0&&(e.x=1920+e.width/2,e.y=n(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)})}