const e="https://api.pixelplush.dev/v1";let t="PixelPlush Game",a="unknown",r={},o={},i="",s=1920,n=1080,l=.5;var c="",d=!0;let p="",f=!0,y={};function h(e){return Math.floor(Math.random()*Math.floor(e))}async function g(r){let i=Object.keys(M).length;return fetch(`${e}/analytics/heartbeat`,{method:"POST",body:JSON.stringify({session:c,game:a,theme:t,channel:o.channel,players:Object.keys(M),count:i})}).then(e=>e.json())}window.setupGame=function(e,a,c){if(t=e,r=a,o=c,i=r.path||"",o.clouds=void 0===o.clouds||null===o.clouds?!o.overlay:"true"===o.clouds,l=void 0===o.volume||null===o.volume?0:parseInt(o.volume)/100,s=Math.min(window.innerWidth,1920),n=Math.min(window.innerHeight,1080),o.variations&&!o.didRandom){const e=o.variations.split(","),t=h(e.length),a=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[t]}${window.location.search}&didRandom=1`;window.location.href=a}o.readyTime&&(f=!1,setTimeout(()=>{f=!0,ComfyJS.Say("Parachute Drop is ready!")},parseInt(o.readyTime||1e3)))},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){if(document.hidden)return void document.addEventListener("visibilitychange",()=>{location.reload()},!1);try{const t=(await fetch("https://www.pixelplush.dev/assets/shamelist.txt").then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());if(o.channel&&t&&t.includes(o.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),d=!1),r.requires)try{if(account=await fetch(`${e}/accounts`,{headers:{Twitch:o.oauth?o.oauth.replace("oauth:",""):void 0}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(r.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}!async function(){a="plinko",o.cpPlink&&(y["Plinko!"]={desc:"Drop into the PixelPlush Plinko Game!",color:"#F2C079",cost:parseInt(o.cpPlinkCost||50),callback:(e,t,a,i,s)=>{f&&(d?(b&&o.hideTilStart&&(b=!1,F.forEach(e=>e.visible=!0),R.forEach(e=>e.sprite.visible=!0),r.hideWalls||(D.forEach(e=>e.sprite.visible=!0),Array.isArray(W)?W[N].visible=!0:W.visible=!0,J&&(J.visible=!0)),r.target&&(Array.isArray(k)?(k[C].visible=!0,r.target_animate_on_landed||u()):k.visible=!0,Array.isArray(O)?(O[T].visible=!0,r.target_animate_on_landed||u()):O.visible=!0,j&&(j.visible=!0))),K(s.username,e,s.userColor||"#ffffff",i,s.messageEmotes?Object.keys(s.messageEmotes)[0]:"")):o.oauth&&ComfyJS.Say("The Plinko Bounce game needs your attention. Please contact the PixelPlush team on Discord."))}})}()}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:s,height:n,background:"transparent",init:Q,update:Z,channel:o.channel,username:o.oauth?o.channel:void 0,password:o.oauth?o.oauth.replace("oauth:",""):void 0,onCommand:x,onChat:$,screenWalls:!1,gravity:{x:0,y:1}}),ComfyJS.onCheer=w,ComfyJS.onConnected=async(e,t,a)=>{if(a){!function(){S=r.target_width||368,U=s/2,E=n-47+(r.target_offset||0),r.target_walls&&(U<S/2+70?U=S/2+70:U>s-S/2-70&&(U=s-S/2-70));if(r.target_versions){const e=h(Object.keys(r.target_versions).length);Object.keys(r.target_versions).forEach((t,a)=>{e===a&&(I=t);let i=r.target_versions[t];if(L[t]={},Array.isArray(i.target))if(r.target_random){let e=h(i.target.length);k=Unicorn.AddBacklay("target"+t+e,"target"+t+e,U,E,{scale:{x:2,y:2}}),k.zIndex=10,k.anchor.set(.5),k.visible=!1,L[t].target=k}else{C=0,k=[];for(let e=0;e<i.target.length;e++){let a=Unicorn.AddBacklay("target"+t+e,"target"+t+e,U,E,{scale:{x:2,y:2}});a.zIndex=10,a.anchor.set(.5),a.visible=!1,k.push(a)}L[t].target=k,k[C].visible=!1,o.hideTilDrop||r.target_animate_on_landed||u()}else k=Unicorn.AddBacklay("target"+t,"target"+t,U,E,{scale:{x:2,y:2}}),k.zIndex=10,k.anchor.set(.5),k.visible=!1,L[t].target=k;if(i.target_overlay)if(Array.isArray(i.target_overlay)){T=0,O=[];for(let e=0;e<i.target_overlay.length;e++){let a=Unicorn.AddBacklay("target_overlay"+t+e,"target_overlay"+t+e,U,E,{scale:{x:2,y:2}});a.zIndex=11,a.anchor.set(.5),a.visible=!1,O.push(a)}L[t].target_overlay=O,O[T].visible=!1,o.hideTilDrop||r.target_animate_on_landed||u()}else O=Unicorn.AddBacklay("target_overlay"+t,"target_overlay"+t,U,E,{scale:{x:2,y:2}}),O.zIndex=11,O.anchor.set(.5),O.visible=!1,L[t].target_overlay=O})}else if(r.target){if(Array.isArray(r.target))if(r.target_random){let e=h(r.target.length);k=Unicorn.AddBacklay("target"+e,"target"+e,U,E,{scale:{x:2,y:2}}),k.zIndex=10,k.anchor.set(.5)}else{C=0,k=[];for(let e=0;e<r.target.length;e++){let t=Unicorn.AddBacklay("target"+e,"target"+e,U,E,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,k.push(t)}k[C].visible=!0,o.hideTilDrop||r.target_animate_on_landed||u()}else k=Unicorn.AddBacklay("target","target",U,E,{scale:{x:2,y:2}}),k.zIndex=10,k.anchor.set(.5);if(r.target_overlay)if(Array.isArray(r.target_overlay)){T=0,O=[];for(let e=0;e<r.target_overlay.length;e++){let t=Unicorn.AddBacklay("target_overlay"+e,"target_overlay"+e,U,E,{scale:{x:2,y:2}});t.zIndex=11,t.anchor.set(.5),t.visible=!1,O.push(t)}O[T].visible=!0,o.hideTilDrop||r.target_animate_on_landed||u()}else O=Unicorn.AddBacklay("target_overlay","target_overlay",U,E,{scale:{x:2,y:2}}),O.zIndex=11,O.anchor.set(.5)}r.target_front&&(j=Unicorn.AddOverlay("target_front","target_front",U,E,{scale:{x:2,y:2}}),j.anchor.set(.5));if(o.clouds)for(let e=0;e<11;e++){v++;let e=r.clouds[h(r.clouds.length)],t=Unicorn.AddOverlay("cloud_"+v,e,h(s),h(500),{scale:{x:3,y:3}});t.alpha=o.overlay?.5:.9,t.anchor.set(.5),t.speed=.01+.1*Math.random(),t.zIndex=t.speed,F.push(t)}o.hideTilStart&&(F.forEach(e=>e.visible=!1),R.forEach(e=>e.sprite.visible=!1),D.forEach(e=>e.sprite.visible=!1),Array.isArray(W)?W.forEach(e=>e.visible=!1):W.visible=!1,J&&(J.visible=!1));r.target_walls&&(Unicorn.AddObject("TargetTop",{type:"rectangle",x:U,y:E+r.target_walls/2+r.target_collide_land,width:S-50,height:10,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("TargetLeft",{type:"rectangle",x:U-S/2+27,y:E+r.target_walls,width:10,height:100,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("TargetRight",{type:"rectangle",x:U+S/2-27,y:E+r.target_walls,width:10,height:100,isStatic:!0}).sprite.visible=!1)}();let e=await g();if(0!==e&&(c=e.session,setInterval(()=>{g()},6e4)),o.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${e}`}}).then(e=>e.json()).catch(e=>({error:e}))}(o.oauth.replace("oauth:",""));p=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scopes.includes(t))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let t=await ComfyJS.GetChannelRewards(p,!0),a=Object.keys(y);for(let e=0;e<a.length;e++){let r=a[e];if(!t.some(e=>e.title===r))try{await ComfyJS.CreateChannelReward(p,{title:r,prompt:y[r].desc,cost:y[r].cost,is_enabled:!0,background_color:y[r].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!y[r].cooldown,global_cooldown_seconds:y[r].cooldown,should_redemptions_skip_request_queue:!0})}catch(e){console.log(e)}}}},ComfyJS.onReward=(e,t,a,r,o)=>{y[t]&&y[t].callback(e,t,a,r,o)}}()}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();let m=null,_=0;function u(e=0){if(m&&clearInterval(m),r.target_versions){Object.keys(L).forEach(e=>{Array.isArray(k)?L[e].target.forEach(e=>{e.visible=!1}):L[e].target.visible=!1,L[e].target_overlay.forEach(e=>{e.visible=!1})});const e=h(Object.keys(L).length);I=Object.keys(L)[e],k=L[I].target,O=L[I].target_overlay,Array.isArray(k)?k[C].visible=!0:k.visible=!0,O[T].visible=!0}m=setInterval(()=>{Array.isArray(k)&&(k[C].visible=!1,C=(C+1)%k.length,k[C].visible=!0),O&&Array.isArray(O)&&(O[T].visible=!1,T=(T+1)%O.length,O[T].visible=!0)},60),e>0&&(_=1e3*e)}let v=0,b=!0;async function x(e,t,a,i,s){if(!i.broadcaster&&!i.mod||"resetplinko"!==t&&"resetboing"!==t||location.reload(),(i.broadcaster||i.mod)&&("deleteplinko"===t||"deleteboing"===t)){let e=await ComfyJS.GetChannelRewards(p,!0),t=Object.keys(y);for(let a=0;a<t.length;a++){let r=t[a],o=e.find(e=>e.title===r);o&&await ComfyJS.DeleteChannelReward(p,o.id)}}if((i.broadcaster||i.mod)&&"testplinko"===t)for(var n=0;n<50;n++)v++,K("test"+v,"test_"+v,s.userColor||"#ffffff",Object.keys(r.characters)[h(Object.keys(r.characters).length)]);let l=!1;if(!o.commandOn&&o.cpPlink||!o.command||t!==o.command||(l=!0),!o.commandOn&&o.cpPlink||o.command||"plink"!==t&&"plinko"!==t&&"boing"!==t&&"boingboing"!==t||(l=!0),f)if(d){if(l){b&&o.hideTilStart&&(b=!1,F.forEach(e=>e.visible=!0),R.forEach(e=>e.sprite.visible=!0),r.hideWalls||(D.forEach(e=>e.sprite.visible=!0),Array.isArray(W)?W[N].visible=!0:W.visible=!0,J&&(J.visible=!0)),r.target&&(Array.isArray(k)?(k[C].visible=!0,r.target_animate_on_landed||u()):k.visible=!0,Array.isArray(O)?(O[T].visible=!0,r.target_animate_on_landed||u()):O.visible=!0,j&&(j.visible=!0)));const t=twemoji.parse(a,{assetType:"png"});!s.messageEmotes&&t.length>0?K(s.username,e,s.userColor||"#ffffff",a,"",t[0].url):K(s.username,e,s.userColor||"#ffffff",a,s.messageEmotes?Object.keys(s.messageEmotes)[0]:"")}}else l&&o.oauth&&ComfyJS.Say("The Plinko Bounce game needs your attention. Please contact the PixelPlush team on Discord.")}function $(e,t,a,r,o){}function w(e,t,a,r,o){document.hidden}let A=null,S=368,U=0,E=0,k=null,O=null,j=null,C=0,T=0,L={},I=null,M={},P={},z={},F=[],B=[],R=[],D=[],J=null,W=null,N=0,X=0,Y=0,G=0;function q(e,t,a,r,o,i=""){G++;let s=Math.min(Math.max(1,o),100);Unicorn.AddParticles("Splash_"+G,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:t,intensity:s,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:i||void 0},a,r),function(e,t=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},t)}("Splash_"+G,150)}function H(e,t,a,o=""){const i=r.target_boosh_scale||2;r.target_boosh.forEach((a,r)=>{for(let a=0;a<h(5);a++){G++;let r=Unicorn.AddBacklay("boosh_"+G,"target_boosh"+a,e,t+10,{scale:{x:i,y:i}});r.zIndex=11,r.vX=h(50)-25,r.vY=-350+h(100),r.anchor.set(.5),B.push(r)}})}function V(e,t,a,o=""){const i=r.target_splash_scale||2;r.target_splash.forEach((a,r)=>{for(let a=0;a<h(5);a++){G++;let r=Unicorn.AddBacklay("splash_"+G,"target_splash"+a,e,t+10,{scale:{x:i,y:i}});r.zIndex=11,r.vX=h(100)-50,r.vY=-300+h(100),r.anchor.set(.5),splashes.push(r)}})}async function K(t,a,n="#ffffff",c,d="",p=""){let f=4/60;if(!M[t]){M[t]={};let g=null,m=null,_=null,b=tinycolor(n),x={};try{let a=await fetch(`${e}/accounts/twitch/design?username=${t}`).then(e=>e.json());a&&(x=a.style||{})}catch(e){console.log(e)}if(x.pet&&x.pet.id&&"pet_none"!==x.pet.id&&(r.pets||(r.pets={}),m=x.pet.id.replace("pet_",""),!r.pets[m])){r.pets[m]={path:x.pet.path,minIdle:x.pet.minIdle,maxIdle:x.pet.maxIdle};for(let e=0;e<10;e++){let t=x.pet.path+"_front";Unicorn.Load(t+e,`${i}/assets/pets/${m}/${t}/${t}${e+1}.png`)}}if(d){if(!P[d]){if(P[d]=!0,d.startsWith("emotesv2_")){let e=`https://static-cdn.jtvnw.net/emoticons/v2/${d}/default/dark/2.0`,r=await fetchGif(e);if(r.length>0){const e=function(e,t){const a=Math.min(...e.map(e=>e.delay)),r=Math.max(...e.map(e=>e.dims.width)),o=Math.max(...e.map(e=>e.dims.height)),i=r,s=o;let n=0;for(let s=0;s<e.length;s++){let l=document.createElement("canvas");l.width=r,l.height=o;let c=l.getContext("2d"),d=c.createImageData(r,o);if(1===e[s].disposalType){let t=s;for(let a=e[t].dims.top;a<o;a++)for(let o=e[t].dims.left;o<r;o++)a>=e[t].dims.top&&o>=e[t].dims.left&&a<e[t].dims.top+e[t].dims.height&&o<e[t].dims.left+e[t].dims.width&&e[t].pixels[a*i+o]!==e[t].transparentIndex?(d.data[a*i*4+4*o+0]=e[t].patch[a*i*4+4*o+0],d.data[a*i*4+4*o+1]=e[t].patch[a*i*4+4*o+1],d.data[a*i*4+4*o+2]=e[t].patch[a*i*4+4*o+2],d.data[a*i*4+4*o+3]=e[t].patch[a*i*4+4*o+3]):0===t&&(d.data[a*i*4+4*o+0]=e[0].patch[a*i*4+4*o+0],d.data[a*i*4+4*o+1]=e[0].patch[a*i*4+4*o+1],d.data[a*i*4+4*o+2]=e[0].patch[a*i*4+4*o+2],d.data[a*i*4+4*o+3]=e[0].patch[a*i*4+4*o+3])}else if(3===e[s].disposalType){let t=null;for(let a=0;a<=s;a++){for(let t=0;t<o;t++)for(let o=0;o<r;o++)if(t>=e[a].dims.top&&o>=e[a].dims.left&&t<e[a].dims.top+e[a].dims.height&&o<e[a].dims.left+e[a].dims.width){const r=(t-e[a].dims.top)*e[a].dims.width+(o-e[a].dims.left),s=(t-e[a].dims.top)*e[a].dims.width*4+4*(o-e[a].dims.left);e[a].pixels[r]!==e[a].transparentIndex?(d.data[t*i*4+4*o+0]=e[a].patch[s+0],d.data[t*i*4+4*o+1]=e[a].patch[s+1],d.data[t*i*4+4*o+2]=e[a].patch[s+2],d.data[t*i*4+4*o+3]=e[a].patch[s+3]):(d.data[t*i*4+4*o+0]=0,d.data[t*i*4+4*o+1]=0,d.data[t*i*4+4*o+2]=0,d.data[t*i*4+4*o+3]=0)}0===a&&(t=d.data.slice())}}else{let t=s;for(let a=e[t].dims.top;a<o;a++)for(let o=e[t].dims.left;o<r;o++){const r=(a-e[t].dims.top)*e[t].dims.width+(o-e[t].dims.left),s=(a-e[t].dims.top)*e[t].dims.width*4+4*(o-e[t].dims.left);a>=e[t].dims.top&&o>=e[t].dims.left&&a<e[t].dims.top+e[t].dims.height&&o<e[t].dims.left+e[t].dims.width&&e[t].pixels[r]!==e[t].transparentIndex&&(d.data[a*i*4+4*o+0]=e[t].patch[s+0],d.data[a*i*4+4*o+1]=e[t].patch[s+1],d.data[a*i*4+4*o+2]=e[t].patch[s+2],d.data[a*i*4+4*o+3]=e[t].patch[s+3])}}c.putImageData(d,0,0);for(let i=0;i<e[s].delay;i+=a)Unicorn.LoadCustom(`${t}${n}`,l,"texture",{width:r,height:o}),n++}return{frames:n,minDelay:a,width:i,height:s}}(r,`emote_${d}`);P[d]={frames:e.frames,framerate:1/60*(1e3/e.minDelay)},setTimeout(()=>{delete M[t],K(t,a,n,c,d,p)},500)}else Unicorn.Load(`emote_${d}0`,e),setTimeout(()=>{delete M[t],K(t,a,n,c,d,p)},500)}else{let e=`https://static-cdn.jtvnw.net/emoticons/v1/${d}/2.0`;Unicorn.Load(`emote_${d}0`,e),setTimeout(()=>{delete M[t],K(t,a,n,c,d,p)},500)}return}let e=[];if(d.startsWith("emotesv2_")&&"boolean"!=typeof P[d]){f=P[d].framerate;for(let t=0;t<P[d].frames;t++)e.push(`emote_${d}${t}`)}else e=[`emote_${d}0`];g=Unicorn.AddObject("player_"+t,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:f,frames:e,loop:!0}},x:200+h(s-400),y:-100-h(50),z:100,radius:36,onCollide:(e,a,i)=>{if("TargetTop"===e){if(M[t].isLanded=!0,g.collisionFilter.category=1,g.isSensor=!0,g.isStatic=!0,r.target_versions&&u(),r.target_effect){v++;const e=`te_${v}`;let a=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:r.target_effect.length},(e,t)=>`target_effect${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:M[t].player.position.x,y:M[t].player.position.y,z:200,radius:.1});a.isSensor=!0,a.animations.front.anchor.y=1}if(I&&r.target_versions[I].target_effect){v++;const e=`te_${v}`;let a=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:r.target_versions[I].target_effect.length},(e,t)=>`target_effect${I}${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:M[t].player.position.x,y:M[t].player.position.y,z:200,radius:.1});a.isSensor=!0,a.animations.front.anchor.y=1}if(r.target_animate_on_landed&&u(2),r.target_particles&&q(r.target_particles[0],r.target_particles[1],M[t].player.position.x,M[t].player.position.y+40,10),r.target_boosh&&H(M[t].player.position.x,M[t].player.position.y+40),r.target_splash&&V(M[t].player.position.x,M[t].player.position.y+40),console.log("Winner: "+t),Unicorn.PlaySound("sfx-win",{volume:l}),o.messageFormat){let e=o.messageFormat.replace("USERNAME",t);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}},onEnter:(e,a)=>{if("bottom_detect"===e&&(M[t].isLanded=!0,g.collisionFilter.category=1,g.isSensor=!0,g.isStatic=!0,r.target_boosh&&H(M[t].player.position.x,M[t].player.position.y+40),1*s/5+s/5-8<g.position.x&&g.position.x<2*s/5+s/5-8&&(console.log("Winner: "+t),Unicorn.PlaySound("sfx-win",{volume:l}),r.target_animate_star_on_landed&&Y++,o.messageFormat))){let e=o.messageFormat.replace("USERNAME",t);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}}),g.endImage=`emote_${d}`,g.endScale=1.2}else if(p){if(!z[p])return z[p]=!0,Unicorn.Load(`emoji_${p}`,p),void setTimeout(()=>{delete M[t],K(t,a,n,c,d,p)},500);g=Unicorn.AddObject("player_"+t,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:f,frames:[`emoji_${p}`],loop:!0}},x:200+h(s-400),y:-100-h(50),z:100,radius:36,onCollide:(e,a,i)=>{if("TargetTop"===e){if(M[t].isLanded=!0,g.collisionFilter.category=1,g.isSensor=!0,g.isStatic=!0,r.target_versions&&u(),r.target_effect){v++;const e=`te_${v}`;let a=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:r.target_effect.length},(e,t)=>`target_effect${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:M[t].player.position.x,y:M[t].player.position.y,z:200,radius:.1});a.isSensor=!0,a.animations.front.anchor.y=1}if(I&&r.target_versions[I].target_effect){v++;const e=`te_${v}`;let a=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:r.target_versions[I].target_effect.length},(e,t)=>`target_effect${I}${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:M[t].player.position.x,y:M[t].player.position.y,z:200,radius:.1});a.isSensor=!0,a.animations.front.anchor.y=1}if(r.target_animate_on_landed&&u(2),r.target_particles&&q(r.target_particles[0],r.target_particles[1],M[t].player.position.x,M[t].player.position.y+40,10),r.target_boosh&&H(M[t].player.position.x,M[t].player.position.y+40),r.target_splash&&V(M[t].player.position.x,M[t].player.position.y+40),console.log("Winner: "+t),Unicorn.PlaySound("sfx-win",{volume:l}),o.messageFormat){let e=o.messageFormat.replace("USERNAME",t);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}},onEnter:(e,a)=>{if("bottom_detect"===e&&(M[t].isLanded=!0,g.collisionFilter.category=1,g.isSensor=!0,g.isStatic=!0,r.target_boosh&&H(M[t].player.position.x,M[t].player.position.y+40),1*s/5+s/5-8<g.position.x&&g.position.x<2*s/5+s/5-8&&(console.log("Winner: "+t),Unicorn.PlaySound("sfx-win",{volume:l}),r.target_animate_star_on_landed&&Y++,o.messageFormat))){let e=o.messageFormat.replace("USERNAME",t);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}}),g.endImage=`emoji_${p}`,g.endScale=1}else{if(!r.characters[c])if(x.character&&x.character.id){if(!r.characters[x.character.id]){r.characters[x.character.id]=x.character.path;for(let e=0;e<10;e++){let t=r.characters[x.character.id];Unicorn.Load(`${x.character.id}_${e}`,`${i}/assets/characters/${x.character.id}/${t}_front/${t}_front${e+1}.png`)}}c=x.character.id}else c=r.playable[Math.floor(r.playable.length*Math.random())];if(g=Unicorn.AddObject("player_"+t,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:f,frames:[...Array(10).keys()].map(e=>`${c}_${e}`),loop:!0}},x:200+h(s-400),y:-100-h(50),z:100,radius:36,onCollide:(e,a,i)=>{if("TargetTop"===e){if(M[t].isLanded=!0,g.collisionFilter.category=1,g.isSensor=!0,g.isStatic=!0,r.target_versions&&u(),r.target_effect){v++;const e=`te_${v}`;let a=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:r.target_effect.length},(e,t)=>`target_effect${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:M[t].player.position.x,y:M[t].player.position.y,z:200,radius:.1});a.isSensor=!0,a.animations.front.anchor.y=1}if(I&&r.target_versions[I].target_effect){v++;const e=`te_${v}`;let a=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:r.target_versions[I].target_effect.length},(e,t)=>`target_effect${I}${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:M[t].player.position.x,y:M[t].player.position.y,z:200,radius:.1});a.isSensor=!0,a.animations.front.anchor.y=1}if(r.target_animate_on_landed&&u(2),r.target_particles&&q(r.target_particles[0],r.target_particles[1],M[t].player.position.x,M[t].player.position.y+40,10),r.target_boosh&&H(M[t].player.position.x,M[t].player.position.y+40),r.target_splash&&V(M[t].player.position.x,M[t].player.position.y+40),console.log("Winner: "+t),Unicorn.PlaySound("sfx-win",{volume:l}),o.messageFormat){let e=o.messageFormat.replace("USERNAME",t);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}},onEnter:(e,a)=>{if("bottom_detect"===e&&(M[t].isLanded=!0,g.collisionFilter.category=1,g.isSensor=!0,g.isStatic=!0,r.target_boosh&&H(M[t].player.position.x,M[t].player.position.y+40),1*s/5+s/5-8<g.position.x&&g.position.x<2*s/5+s/5-8&&(console.log("Winner: "+t),Unicorn.PlaySound("sfx-win",{volume:l}),r.target_animate_star_on_landed&&Y++,o.messageFormat))){let e=o.messageFormat.replace("USERNAME",t);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}}),g.endImage=`${c}_0`,g.endScale=3,"boybear"===c||"girlbear"===c){var y=PIXI.utils.string2hex(b.brighten(50).toHexString());g.animations.front.tint=y}if(m){let e={front:[]};for(let t=0;t<10;t++)Object.keys(e).forEach(a=>{e[a].push(r.pets[m].path+"_"+a+t)});_=Unicorn.AddObject("pet_"+t,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:f,frames:e.front,loop:!0}},x:-1e3,y:-1e3,z:200,radius:24,isStatic:!0}),_.isSensor=!0}}let $=Unicorn.AddText("name_"+t,a,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:n,lineJoin:"round",stroke:b.getLuminance()<.6?"#ffffff":"#000000",strokeThickness:6});$.anchor.set(.5),g.rotationOffset=Math.random()*Math.PI,M[t]={player:g,label:$,pet:_,petType:m,petOffset:50*Math.random()-25},A&&clearTimeout(A),A=setTimeout(()=>{location.reload()},parseInt(o.cooldown||9e4))}}function Q(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${i}/assets/${r.bg}.png`),!o.overlay){var e=Unicorn.AddBacklay("map","map",0,n-1080);e.scale.x=3,e.scale.y=3}if(r.target_versions)Object.keys(r.target_versions).forEach(e=>{let t=r.target_versions[e];if(Array.isArray(t.target)){t.target.map((t,a)=>Unicorn.Load("target"+e+a,`${i}/assets/${t}.png`))}else{Unicorn.Load("target"+e,`${i}/assets/${t.target}.png`)}if(Array.isArray(t.target_overlay)){t.target_overlay.map((t,a)=>Unicorn.Load("target_overlay"+e+a,`${i}/assets/${t}.png`))}else{Unicorn.Load("target_overlay"+e,`${i}/assets/${t.target_overlay}.png`)}if(t.target_effect){t.target_effect.map((t,a)=>Unicorn.Load("target_effect"+e+a,`${i}/assets/${t}.png`))}});else if(r.target){if(Array.isArray(r.target)){r.target.map((e,t)=>Unicorn.Load("target"+t,`${i}/assets/${e}.png`))}else{Unicorn.Load("target",`${i}/assets/${r.target}.png`)}if(Array.isArray(r.target_overlay)){r.target_overlay.map((e,t)=>Unicorn.Load("target_overlay"+t,`${i}/assets/${e}.png`))}else{Unicorn.Load("target_overlay",`${i}/assets/${r.target_overlay}.png`)}if(r.target_effect){r.target_effect.map((e,t)=>Unicorn.Load("target_effect"+t,`${i}/assets/${e}.png`))}}r.target_front&&Unicorn.Load("target_front",`${i}/assets/${r.target_front}.png`),r.target_boosh&&r.target_boosh.forEach((e,t)=>{Unicorn.Load("target_boosh"+t,`${i}/assets/${e}.png`)}),r.target_splash&&r.target_splash.forEach((e,t)=>{Unicorn.Load("target_splash"+t,`${i}/assets/${e}.png`)}),r.wall&&Unicorn.Load("wall",`${i}/assets/${r.wall}.png`),r.wallfront&&Unicorn.Load("wallfront",`${i}/assets/${r.wallfront}.png`),Array.isArray(r.peg)?r.peg.forEach((e,t)=>{Unicorn.Load("peg"+t,`${i}/assets/${e}.png`)}):Unicorn.Load("peg",`${i}/assets/${r.peg}.png`),Array.isArray(r.star)?r.star.forEach((e,t)=>{Unicorn.Load("star"+t,`${i}/assets/${e}.png`)}):Unicorn.Load("star",`${i}/assets/${r.star}.png`),Object.keys(r.characters).forEach(e=>{for(let t=0;t<10;t++){let a=r.characters[e];Unicorn.Load(`${e}_${t}`,`${i}/assets/characters/${e}/${a}_front/${a}_front${t+1}.png`)}}),r.clouds.forEach(e=>Unicorn.Load(e,`${i}/assets/${e}.png`)),Unicorn.Load("sfx-peg-bounce",`${i}/assets/${r.peg_sound}`),Unicorn.Load("sfx-win",`${i}/assets/${r.win_sound}`);for(let e=0;e<4;e++){let t,a,i;e%2==0?(t=Math.floor(s/137),a=s/t,i=a,t--):(t=Math.floor((s-137)/137),t--,a=137,i=137+a/2);for(let s=0;s<t;s++){let t="peg";Array.isArray(r.peg)&&(t="peg"+(s+2*e)%r.peg.length);let c=Unicorn.AddObject(`peg_${e}-${s}`,{type:"circle",x:s*a+i,y:n-240-200*e,radius:27,scale:{x:3,y:3},sprite:t,isStatic:!0,density:1/0,friction:1,frictionStatic:.5,frictionAir:.01,onEnter:(e,t)=>{e.startsWith("player_")&&Unicorn.PlaySound("sfx-peg-bounce",{volume:l})}});c.sprite.alpha=o.overlay?.15:1,c.restitution=1.05,c.mass=1/0,c.inverseMass=0,R.push(c)}}if(!r.hideWalls){for(let e=0;e<4;e++){let t=Unicorn.AddObject(`wall_${e}`,{type:"rectangle",x:e*s/5+s/5-8,y:n-60,width:12,height:120,scale:{x:3,y:3},sprite:"wall",isStatic:!0});D.push(t)}r.wallfront&&(J=Unicorn.AddBacklay("wallfront","wallfront",0,n-1080),J.scale.x=s/1920*3,J.scale.y=3)}Unicorn.AddObject("bottom_detect",{type:"rectangle",x:s/2,y:n-2,width:s,height:2,isStatic:!0,isSensor:!0}).sprite.visible=!1;let t=Unicorn.AddObject("left_bound",{type:"rectangle",x:-100,y:n/2,width:200,height:n,isStatic:!0});t.restitution=1.05,t.mass=1/0,t.inverseMass=0,t.sprite.visible=!1;let a=Unicorn.AddObject("right_bound",{type:"rectangle",x:s+100,y:n/2,width:200,height:n,isStatic:!0});if(a.restitution=1.05,a.mass=1/0,a.inverseMass=0,a.sprite.visible=!1,Array.isArray(r.star)){N=0,W=[];for(let e=0;e<r.star.length;e++){let t=Unicorn.AddBacklay(`star${e}`,`star${e}`,s/2+(r.starXOffset||0),n-80+(r.starYOffset||0),{scale:{x:3,y:3}});t.anchor.set(.5),t.visible=!r.hideWalls,W.push(t)}for(let e=0;e<r.star.length;e++)W[e].visible=!1;W[N].visible=!0}else W=Unicorn.AddBacklay("star","star",s/2+(r.starXOffset||0),n-80+(r.starYOffset||0),{scale:{x:3,y:3}}),W.anchor.set(.5),W.visible=!r.hideWalls;Matter.Events.on(physics,"beforeUpdate",(function(e){for(var t in M)M[t].player&&Matter.Body.setVelocity(M[t].player,{x:Math.max(Math.min(M[t].player.velocity.x,30),-30),y:Math.max(Math.min(M[t].player.velocity.y,30),-30)})}))}function Z(e,t){for(var a in M)M[a].player&&(M[a].isLanded,M[a].label.position.x=M[a].player.position.x,M[a].label.position.y=M[a].player.position.y-60,M[a].pet&&(M[a].pet.angle=M[a].player.angle,M[a].pet.position.x=Math.max(20,Math.min(s-20,M[a].player.position.x+M[a].petOffset)),M[a].pet.position.y=M[a].player.position.y+20));F.forEach((e,a)=>{e.x-=t*e.speed,e.x+e.width/2<=0&&(e.x=s+e.width/2,e.y=h(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)}),B.forEach(e=>{(e.vY<0||e.y<n-5)&&(e.x+=t/1e3*e.vX,e.y+=t/1e3*e.vY,e.vY<20&&(e.vY+=t/1e3*200))}),Y>0&&Array.isArray(r.star)&&(X-=t,X<=0&&(X+=60,W[N].visible=!1,N=(N+1)%W.length,W[N].visible=!0,r.target_animate_star_on_landed&&0===N&&Y--))}