const e="https://api.pixelplush.dev/v1";let t="Pixel Plinko",a={},r={},o="",i=1920,s=1080,n=.5;function l(e){return Math.floor(Math.random()*Math.floor(e))}window.setupGame=function(e,l,c){t=e,a=l,r=c,o=a.path||"",r.clouds=void 0===r.clouds||null===r.clouds?!r.overlay:r.clouds,n=void 0===r.volume||null===r.volume?0:parseInt(r.volume)/100,i=Math.min(window.innerWidth,1920),s=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){try{const t=(await fetch(`${o}/assets/shamelist.txt`).then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());if(r.channel&&t&&t.includes(r.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),d=!1),a.requires)try{if(account=await fetch(`${e}/accounts`,{headers:{Twitch:r.oauth?r.oauth.replace("oauth:",""):void 0}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(a.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}r.cpPlink&&(f["Plinko!"]={desc:"Drop into the PixelPlush Plinko Game!",color:"#F2C079",cost:parseInt(r.cpPlinkCost||50),callback:(e,t,o,i,s)=>{d?(u&&r.hideTilStart&&(u=!1,M.forEach(e=>e.visible=!0),z.forEach(e=>e.sprite.visible=!0),a.hideWalls||(F.forEach(e=>e.sprite.visible=!0),R.visible=!0,B&&(B.visible=!0)),a.target&&(Array.isArray(w)?(w[k].visible=!0,a.target_animate_on_landed||m()):w.visible=!0,Array.isArray(U)?(U[O].visible=!0,a.target_animate_on_landed||m()):U.visible=!0,E&&(E.visible=!0))),G(s.username,e,s.userColor||"#ffffff",i,s.messageEmotes?Object.keys(s.messageEmotes)[0]:"")):r.oauth&&ComfyJS.Say("PixelParachute is disabled in this channel for violating the Terms of Service. To re-enable the game, please contact the PixelPlush team on Discord.")}})}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:i,height:s,background:"transparent",init:H,update:V,channel:r.channel,username:r.oauth?r.channel:void 0,password:r.oauth?r.oauth.replace("oauth:",""):void 0,onCommand:v,onChat:b,wallBottom:!0,gravity:{x:0,y:1}}),ComfyJS.onConnected=async(e,t,o)=>{if(o){!function(){$=a.target_width||368,A=i/2,S=s-47+(a.target_offset||0),a.target_walls&&(A<$/2+70?A=$/2+70:A>i-$/2-70&&(A=i-$/2-70));if(a.target_versions){const e=l(Object.keys(a.target_versions).length);Object.keys(a.target_versions).forEach((t,o)=>{e===o&&(T=t);let i=a.target_versions[t];if(j[t]={},Array.isArray(i.target))if(a.target_random){let e=l(i.target.length);w=Unicorn.AddBacklay("target"+t+e,"target"+t+e,A,S,{scale:{x:2,y:2}}),w.zIndex=10,w.anchor.set(.5),w.visible=!1,j[t].target=w}else{k=0,w=[];for(let e=0;e<i.target.length;e++){let a=Unicorn.AddBacklay("target"+t+e,"target"+t+e,A,S,{scale:{x:2,y:2}});a.zIndex=10,a.anchor.set(.5),a.visible=!1,w.push(a)}j[t].target=w,w[k].visible=!1,r.hideTilDrop||a.target_animate_on_landed||m()}else w=Unicorn.AddBacklay("target"+t,"target"+t,A,S,{scale:{x:2,y:2}}),w.zIndex=10,w.anchor.set(.5),w.visible=!1,j[t].target=w;if(i.target_overlay)if(Array.isArray(i.target_overlay)){O=0,U=[];for(let e=0;e<i.target_overlay.length;e++){let a=Unicorn.AddBacklay("target_overlay"+t+e,"target_overlay"+t+e,A,S,{scale:{x:2,y:2}});a.zIndex=11,a.anchor.set(.5),a.visible=!1,U.push(a)}j[t].target_overlay=U,U[O].visible=!1,r.hideTilDrop||a.target_animate_on_landed||m()}else U=Unicorn.AddBacklay("target_overlay"+t,"target_overlay"+t,A,S,{scale:{x:2,y:2}}),U.zIndex=11,U.anchor.set(.5),U.visible=!1,j[t].target_overlay=U})}else if(a.target){if(Array.isArray(a.target))if(a.target_random){let e=l(a.target.length);w=Unicorn.AddBacklay("target"+e,"target"+e,A,S,{scale:{x:2,y:2}}),w.zIndex=10,w.anchor.set(.5)}else{k=0,w=[];for(let e=0;e<a.target.length;e++){let t=Unicorn.AddBacklay("target"+e,"target"+e,A,S,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,w.push(t)}w[k].visible=!0,r.hideTilDrop||a.target_animate_on_landed||m()}else w=Unicorn.AddBacklay("target","target",A,S,{scale:{x:2,y:2}}),w.zIndex=10,w.anchor.set(.5);if(a.target_overlay)if(Array.isArray(a.target_overlay)){O=0,U=[];for(let e=0;e<a.target_overlay.length;e++){let t=Unicorn.AddBacklay("target_overlay"+e,"target_overlay"+e,A,S,{scale:{x:2,y:2}});t.zIndex=11,t.anchor.set(.5),t.visible=!1,U.push(t)}U[O].visible=!0,r.hideTilDrop||a.target_animate_on_landed||m()}else U=Unicorn.AddBacklay("target_overlay","target_overlay",A,S,{scale:{x:2,y:2}}),U.zIndex=11,U.anchor.set(.5)}a.target_front&&(E=Unicorn.AddOverlay("target_front","target_front",A,S,{scale:{x:2,y:2}}),E.anchor.set(.5));if(r.clouds)for(let e=0;e<11;e++){_++;let e=a.clouds[l(a.clouds.length)],t=Unicorn.AddOverlay("cloud_"+_,e,l(i),l(500),{scale:{x:3,y:3}});t.alpha=r.overlay?.5:.9,t.anchor.set(.5),t.speed=.01+.1*Math.random(),t.zIndex=t.speed,M.push(t)}r.hideTilStart&&(M.forEach(e=>e.visible=!1),z.forEach(e=>e.sprite.visible=!1),F.forEach(e=>e.sprite.visible=!1),R.visible=!1,B&&(B.visible=!1));a.target_walls&&(Unicorn.AddObject("TargetTop",{type:"rectangle",x:A,y:S+a.target_walls/2+a.target_collide_land,width:$-50,height:10,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("TargetLeft",{type:"rectangle",x:A-$/2+27,y:S+a.target_walls,width:10,height:100,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("TargetRight",{type:"rectangle",x:A+$/2-27,y:S+a.target_walls,width:10,height:100,isStatic:!0}).sprite.visible=!1)}();let e=await g();if(0!==e&&(c=e.session,setInterval(()=>{g()},6e4)),r.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${e}`}}).then(e=>e.json()).catch(e=>({error:e}))}(r.oauth.replace("oauth:",""));console.log(e),p=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(t=>e.scopes.includes(t))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}let t=[];try{t=await ComfyJS.GetChannelRewards(p,!0)}catch(e){console.log(e)}let o=Object.keys(f);console.log(f);for(let e=0;e<o.length;e++){let a=o[e];t.some(e=>e.title===a)||await ComfyJS.CreateChannelReward(p,{title:a,prompt:f[a].desc,cost:f[a].cost,is_enabled:!0,background_color:f[a].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!f[a].cooldown,global_cooldown_seconds:f[a].cooldown,should_redemptions_skip_request_queue:!0})}}ComfyJS.onReward=(e,t,a,r,o)=>{f[t]&&f[t].callback(e,t,a,r,o)}}}()}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();var c="",d=!0;let p="";const f={};async function g(){let a=Object.keys(C).length;return fetch(`${e}/analytics/heartbeat`,{method:"POST",body:JSON.stringify({session:c,game:"plinko",theme:t,channel:r.channel,players:Object.keys(C),count:a})}).then(e=>e.json())}let h=null,y=0;function m(e=0){if(h&&clearInterval(h),a.target_versions){Object.keys(j).forEach(e=>{Array.isArray(w)?j[e].target.forEach(e=>{e.visible=!1}):j[e].target.visible=!1,j[e].target_overlay.forEach(e=>{e.visible=!1})});const e=l(Object.keys(j).length);T=Object.keys(j)[e],w=j[T].target,U=j[T].target_overlay,Array.isArray(w)?w[k].visible=!0:w.visible=!0,U[O].visible=!0}h=setInterval(()=>{Array.isArray(w)&&(w[k].visible=!1,k=(k+1)%w.length,w[k].visible=!0),U&&Array.isArray(U)&&(U[O].visible=!1,O=(O+1)%U.length,U[O].visible=!0)},60),e>0&&(y=1e3*e)}let _=0,u=!0;async function v(e,t,o,i,s){if(!i.broadcaster&&!i.mod||"resetplinko"!==t&&"resetboing"!==t||location.reload(),(i.broadcaster||i.mod)&&("deleteplinko"===t||"deleteboing"===t)){let e=await ComfyJS.GetChannelRewards(p,!0),t=Object.keys(f);for(let a=0;a<t.length;a++){let r=t[a],o=e.find(e=>e.title===r);o&&await ComfyJS.DeleteChannelReward(p,o.id)}}if((i.broadcaster||i.mod)&&"testplinko"===t)for(var n=0;n<50;n++)_++,G("test"+_,"test_"+_,s.userColor||"#ffffff",Object.keys(a.characters)[l(Object.keys(a.characters).length)]);let c=!1;if(!r.commandOn&&r.cpPlink||!r.command||t!==r.command||(c=!0),!r.commandOn&&r.cpPlink||r.command||"plink"!==t&&"plinko"!==t&&"boing"!==t&&"boingboing"!==t||(c=!0),d){if(c){u&&r.hideTilStart&&(u=!1,M.forEach(e=>e.visible=!0),z.forEach(e=>e.sprite.visible=!0),a.hideWalls||(F.forEach(e=>e.sprite.visible=!0),R.visible=!0,B&&(B.visible=!0)),a.target&&(Array.isArray(w)?(w[k].visible=!0,a.target_animate_on_landed||m()):w.visible=!0,Array.isArray(U)?(U[O].visible=!0,a.target_animate_on_landed||m()):U.visible=!0,E&&(E.visible=!0)));const t=twemoji.parse(o,{assetType:"png"});!s.messageEmotes&&t.length>0?G(s.username,e,s.userColor||"#ffffff",o,"",t[0].url):G(s.username,e,s.userColor||"#ffffff",o,s.messageEmotes?Object.keys(s.messageEmotes)[0]:"")}}else c&&r.oauth&&ComfyJS.Say("PixelPlinko is disabled in this channel for violating the Terms of Service. To re-enable the game, please contact the PixelPlush team on Discord.")}function b(e,t,a,r,o){}let x=null,$=368,A=0,S=0,w=null,U=null,E=null,k=0,O=0,j={},T=null,C={},L={},I={},M=[],P=[],z=[],F=[],B=null,R=null,W=0,J=60,D=0,N=0;function X(e,t,a,r,o,i=""){N++;let s=Math.min(Math.max(1,o),100);Unicorn.AddParticles("Splash_"+N,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:t,intensity:s,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:i||void 0},a,r),function(e,t=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},t)}("Splash_"+N,150)}function Y(e,t,r,o=""){const i=a.target_boosh_scale||2;a.target_boosh.forEach((a,r)=>{for(let a=0;a<l(5);a++){N++;let r=Unicorn.AddBacklay("boosh_"+N,"target_boosh"+a,e,t+10,{scale:{x:i,y:i}});r.zIndex=11,r.vX=l(50)-25,r.vY=-350+l(100),r.anchor.set(.5),P.push(r)}})}function q(e,t,r,o=""){const i=a.target_splash_scale||2;a.target_splash.forEach((a,r)=>{for(let a=0;a<l(5);a++){N++;let r=Unicorn.AddBacklay("splash_"+N,"target_splash"+a,e,t+10,{scale:{x:i,y:i}});r.zIndex=11,r.vX=l(100)-50,r.vY=-300+l(100),r.anchor.set(.5),splashes.push(r)}})}async function G(t,s,c="#ffffff",d,p="",f=""){let g=4/60;if(!C[t]){C[t]={};let y=null,u=null,v=null,b=tinycolor(c),$={};try{let a=await fetch(`${e}/accounts/twitch/design?username=${t}`).then(e=>e.json());a&&($=a.style||{})}catch(e){console.log(e)}if($.pet&&$.pet.id&&"pet_none"!==$.pet.id&&(a.pets||(a.pets={}),u=$.pet.id.replace("pet_",""),!a.pets[u])){a.pets[u]={path:$.pet.path,minIdle:$.pet.minIdle,maxIdle:$.pet.maxIdle};for(let e=0;e<10;e++){let t=$.pet.path+"_front";Unicorn.Load(t+e,`${o}/assets/pets/${u}/${t}/${t}${e+1}.png`)}}if(p){if(!L[p]){if(L[p]=!0,p.startsWith("emotesv2_")){let e=`https://static-cdn.jtvnw.net/emoticons/v2/${p}/default/dark/2.0`,a=await fetchGif(e);if(a.length>0){const e=Math.min(...a.map(e=>e.delay)),r=Math.max(...a.map(e=>e.dims.width)),o=Math.max(...a.map(e=>e.dims.height)),i=r;let n=0;for(let t=0;t<a.length;t++){let s=document.createElement("canvas");s.width=r,s.height=o;let l=s.getContext("2d"),c=l.createImageData(r,o);if(1===a[t].disposalType){let e=t;for(let t=a[e].dims.top;t<o;t++)for(let o=a[e].dims.left;o<r;o++)t>=a[e].dims.top&&o>=a[e].dims.left&&t<a[e].dims.top+a[e].dims.height&&o<a[e].dims.left+a[e].dims.width&&a[e].pixels[t*i+o]!==a[e].transparentIndex?(c.data[t*i*4+4*o+0]=a[e].patch[t*i*4+4*o+0],c.data[t*i*4+4*o+1]=a[e].patch[t*i*4+4*o+1],c.data[t*i*4+4*o+2]=a[e].patch[t*i*4+4*o+2],c.data[t*i*4+4*o+3]=a[e].patch[t*i*4+4*o+3]):0===e&&(c.data[t*i*4+4*o+0]=a[0].patch[t*i*4+4*o+0],c.data[t*i*4+4*o+1]=a[0].patch[t*i*4+4*o+1],c.data[t*i*4+4*o+2]=a[0].patch[t*i*4+4*o+2],c.data[t*i*4+4*o+3]=a[0].patch[t*i*4+4*o+3])}else if(3===a[t].disposalType){let e=null;for(let s=0;s<=t;s++){for(let e=0;e<o;e++)for(let t=0;t<r;t++)if(e>=a[s].dims.top&&t>=a[s].dims.left&&e<a[s].dims.top+a[s].dims.height&&t<a[s].dims.left+a[s].dims.width){const r=(e-a[s].dims.top)*a[s].dims.width+(t-a[s].dims.left),o=(e-a[s].dims.top)*a[s].dims.width*4+4*(t-a[s].dims.left);a[s].pixels[r]!==a[s].transparentIndex?(c.data[e*i*4+4*t+0]=a[s].patch[o+0],c.data[e*i*4+4*t+1]=a[s].patch[o+1],c.data[e*i*4+4*t+2]=a[s].patch[o+2],c.data[e*i*4+4*t+3]=a[s].patch[o+3]):(c.data[e*i*4+4*t+0]=0,c.data[e*i*4+4*t+1]=0,c.data[e*i*4+4*t+2]=0,c.data[e*i*4+4*t+3]=0)}0===s&&(e=c.data.slice())}}else{let e=t;for(let t=a[e].dims.top;t<o;t++)for(let o=a[e].dims.left;o<r;o++){const r=(t-a[e].dims.top)*a[e].dims.width+(o-a[e].dims.left),s=(t-a[e].dims.top)*a[e].dims.width*4+4*(o-a[e].dims.left);t>=a[e].dims.top&&o>=a[e].dims.left&&t<a[e].dims.top+a[e].dims.height&&o<a[e].dims.left+a[e].dims.width&&a[e].pixels[r]!==a[e].transparentIndex&&(c.data[t*i*4+4*o+0]=a[e].patch[s+0],c.data[t*i*4+4*o+1]=a[e].patch[s+1],c.data[t*i*4+4*o+2]=a[e].patch[s+2],c.data[t*i*4+4*o+3]=a[e].patch[s+3])}}l.putImageData(c,0,0);for(let i=0;i<a[t].delay;i+=e)Unicorn.LoadCustom(`emote_${p}${n}`,s,"texture",{width:r,height:o}),n++}L[p]={frames:n,framerate:1/60*(1e3/e)},setTimeout(()=>{delete C[t],G(t,s,c,d,p,f)},500)}else Unicorn.Load(`emote_${p}0`,e),setTimeout(()=>{delete C[t],G(t,s,c,d,p,f)},500)}else{let e=`https://static-cdn.jtvnw.net/emoticons/v1/${p}/2.0`;Unicorn.Load(`emote_${p}0`,e),setTimeout(()=>{delete C[t],G(t,s,c,d,p,f)},500)}return}let e=[];if(p.startsWith("emotesv2_")&&"boolean"!=typeof L[p]){g=L[p].framerate;for(let t=0;t<L[p].frames;t++)e.push(`emote_${p}${t}`)}else e=[`emote_${p}0`];y=Unicorn.AddObject("player_"+t,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:g,frames:e,loop:!0}},x:200+l(i-400),y:-100-l(50),z:100,radius:36,onCollide:(e,o,i)=>{if("TargetTop"===e){if(C[t].isLanded=!0,y.collisionFilter.category=1,y.isSensor=!0,y.isStatic=!0,a.target_versions&&m(),a.target_effect){_++;const e=`te_${_}`;let r=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:a.target_effect.length},(e,t)=>`target_effect${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:C[t].player.position.x,y:C[t].player.position.y,z:200,radius:.1});r.isSensor=!0,r.animations.front.anchor.y=1}if(T&&a.target_versions[T].target_effect){_++;const e=`te_${_}`;let r=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:a.target_versions[T].target_effect.length},(e,t)=>`target_effect${T}${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:C[t].player.position.x,y:C[t].player.position.y,z:200,radius:.1});r.isSensor=!0,r.animations.front.anchor.y=1}if(a.target_animate_on_landed&&m(2),a.target_particles&&X(a.target_particles[0],a.target_particles[1],C[t].player.position.x,C[t].player.position.y+40,10),a.target_boosh&&Y(C[t].player.position.x,C[t].player.position.y+40),a.target_splash&&q(C[t].player.position.x,C[t].player.position.y+40),console.log("Winner: "+t),Unicorn.PlaySound("sfx-win",{volume:n}),r.messageFormat){let e=r.messageFormat.replace("USERNAME",t);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}},onEnter:(e,o)=>{if("bottom_detect"===e&&(C[t].isLanded=!0,y.collisionFilter.category=1,y.isSensor=!0,y.isStatic=!0,a.target_boosh&&Y(C[t].player.position.x,C[t].player.position.y+40),1*i/5+i/5-8<y.position.x&&y.position.x<2*i/5+i/5-8&&(console.log("Winner: "+t),Unicorn.PlaySound("sfx-win",{volume:n}),a.target_animate_star_on_landed&&D++,r.messageFormat))){let e=r.messageFormat.replace("USERNAME",t);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}}),y.endImage=`emote_${p}`,y.endScale=1.2}else if(f){if(!I[f])return I[f]=!0,Unicorn.Load(`emoji_${f}`,f),void setTimeout(()=>{delete C[t],G(t,s,c,d,p,f)},500);y=Unicorn.AddObject("player_"+t,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:g,frames:[`emoji_${f}`],loop:!0}},x:200+l(i-400),y:-100-l(50),z:100,radius:36,onCollide:(e,o,i)=>{if("TargetTop"===e){if(C[t].isLanded=!0,y.collisionFilter.category=1,y.isSensor=!0,y.isStatic=!0,a.target_versions&&m(),a.target_effect){_++;const e=`te_${_}`;let r=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:a.target_effect.length},(e,t)=>`target_effect${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:C[t].player.position.x,y:C[t].player.position.y,z:200,radius:.1});r.isSensor=!0,r.animations.front.anchor.y=1}if(T&&a.target_versions[T].target_effect){_++;const e=`te_${_}`;let r=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:a.target_versions[T].target_effect.length},(e,t)=>`target_effect${T}${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:C[t].player.position.x,y:C[t].player.position.y,z:200,radius:.1});r.isSensor=!0,r.animations.front.anchor.y=1}if(a.target_animate_on_landed&&m(2),a.target_particles&&X(a.target_particles[0],a.target_particles[1],C[t].player.position.x,C[t].player.position.y+40,10),a.target_boosh&&Y(C[t].player.position.x,C[t].player.position.y+40),a.target_splash&&q(C[t].player.position.x,C[t].player.position.y+40),console.log("Winner: "+t),Unicorn.PlaySound("sfx-win",{volume:n}),r.messageFormat){let e=r.messageFormat.replace("USERNAME",t);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}},onEnter:(e,o)=>{if("bottom_detect"===e&&(C[t].isLanded=!0,y.collisionFilter.category=1,y.isSensor=!0,y.isStatic=!0,a.target_boosh&&Y(C[t].player.position.x,C[t].player.position.y+40),1*i/5+i/5-8<y.position.x&&y.position.x<2*i/5+i/5-8&&(console.log("Winner: "+t),Unicorn.PlaySound("sfx-win",{volume:n}),a.target_animate_star_on_landed&&D++,r.messageFormat))){let e=r.messageFormat.replace("USERNAME",t);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}}),y.endImage=`emoji_${f}`,y.endScale=1}else{if(!a.characters[d])if($.character&&$.character.id){if(!a.characters[$.character.id]){a.characters[$.character.id]=$.character.path;for(let e=0;e<10;e++){let t=a.characters[$.character.id];Unicorn.Load(`${$.character.id}_${e}`,`${o}/assets/characters/${$.character.id}/${t}_front/${t}_front${e+1}.png`)}}d=$.character.id}else d=a.playable[Math.floor(a.playable.length*Math.random())];if(y=Unicorn.AddObject("player_"+t,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:g,frames:[...Array(10).keys()].map(e=>`${d}_${e}`),loop:!0}},x:200+l(i-400),y:-100-l(50),z:100,radius:36,onCollide:(e,o,i)=>{if("TargetTop"===e){if(C[t].isLanded=!0,y.collisionFilter.category=1,y.isSensor=!0,y.isStatic=!0,a.target_versions&&m(),a.target_effect){_++;const e=`te_${_}`;let r=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:a.target_effect.length},(e,t)=>`target_effect${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:C[t].player.position.x,y:C[t].player.position.y,z:200,radius:.1});r.isSensor=!0,r.animations.front.anchor.y=1}if(T&&a.target_versions[T].target_effect){_++;const e=`te_${_}`;let r=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:a.target_versions[T].target_effect.length},(e,t)=>`target_effect${T}${t}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:C[t].player.position.x,y:C[t].player.position.y,z:200,radius:.1});r.isSensor=!0,r.animations.front.anchor.y=1}if(a.target_animate_on_landed&&m(2),a.target_particles&&X(a.target_particles[0],a.target_particles[1],C[t].player.position.x,C[t].player.position.y+40,10),a.target_boosh&&Y(C[t].player.position.x,C[t].player.position.y+40),a.target_splash&&q(C[t].player.position.x,C[t].player.position.y+40),console.log("Winner: "+t),Unicorn.PlaySound("sfx-win",{volume:n}),r.messageFormat){let e=r.messageFormat.replace("USERNAME",t);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}},onEnter:(e,o)=>{if("bottom_detect"===e&&(C[t].isLanded=!0,y.collisionFilter.category=1,y.isSensor=!0,y.isStatic=!0,a.target_boosh&&Y(C[t].player.position.x,C[t].player.position.y+40),1*i/5+i/5-8<y.position.x&&y.position.x<2*i/5+i/5-8&&(console.log("Winner: "+t),Unicorn.PlaySound("sfx-win",{volume:n}),a.target_animate_star_on_landed&&D++,r.messageFormat))){let e=r.messageFormat.replace("USERNAME",t);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}}),y.endImage=`${d}_0`,y.endScale=3,"boybear"===d||"girlbear"===d){var h=PIXI.utils.string2hex(b.brighten(50).toHexString());y.animations.front.tint=h}if(u){let e={front:[]};for(let t=0;t<10;t++)Object.keys(e).forEach(r=>{e[r].push(a.pets[u].path+"_"+r+t)});v=Unicorn.AddObject("pet_"+t,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:g,frames:e.front,loop:!0}},x:-1e3,y:-1e3,z:200,radius:24,isStatic:!0}),v.isSensor=!0}}let A=Unicorn.AddText("name_"+t,s,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:c,lineJoin:"round",stroke:b.getLuminance()<.6?"#ffffff":"#000000",strokeThickness:6});A.anchor.set(.5),y.rotationOffset=Math.random()*Math.PI,C[t]={player:y,label:A,pet:v,petType:u,petOffset:50*Math.random()-25},x&&clearTimeout(x),x=setTimeout(()=>{location.reload()},parseInt(r.cooldown||9e4))}}function H(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${o}/assets/${a.bg}.png`),!r.overlay){var e=Unicorn.AddBacklay("map","map",0,s-1080);e.scale.x=3,e.scale.y=3}if(a.target_versions)Object.keys(a.target_versions).forEach(e=>{let t=a.target_versions[e];if(Array.isArray(t.target)){t.target.map((t,a)=>Unicorn.Load("target"+e+a,`${o}/assets/${t}.png`))}else{Unicorn.Load("target"+e,`${o}/assets/${t.target}.png`)}if(Array.isArray(t.target_overlay)){t.target_overlay.map((t,a)=>Unicorn.Load("target_overlay"+e+a,`${o}/assets/${t}.png`))}else{Unicorn.Load("target_overlay"+e,`${o}/assets/${t.target_overlay}.png`)}if(t.target_effect){t.target_effect.map((t,a)=>Unicorn.Load("target_effect"+e+a,`${o}/assets/${t}.png`))}});else if(a.target){if(Array.isArray(a.target)){a.target.map((e,t)=>Unicorn.Load("target"+t,`${o}/assets/${e}.png`))}else{Unicorn.Load("target",`${o}/assets/${a.target}.png`)}if(Array.isArray(a.target_overlay)){a.target_overlay.map((e,t)=>Unicorn.Load("target_overlay"+t,`${o}/assets/${e}.png`))}else{Unicorn.Load("target_overlay",`${o}/assets/${a.target_overlay}.png`)}if(a.target_effect){a.target_effect.map((e,t)=>Unicorn.Load("target_effect"+t,`${o}/assets/${e}.png`))}}a.target_front&&Unicorn.Load("target_front",`${o}/assets/${a.target_front}.png`),a.target_boosh&&a.target_boosh.forEach((e,t)=>{Unicorn.Load("target_boosh"+t,`${o}/assets/${e}.png`)}),a.target_splash&&a.target_splash.forEach((e,t)=>{Unicorn.Load("target_splash"+t,`${o}/assets/${e}.png`)}),a.wall&&Unicorn.Load("wall",`${o}/assets/${a.wall}.png`),a.wallfront&&Unicorn.Load("wallfront",`${o}/assets/${a.wallfront}.png`),Array.isArray(a.peg)?a.peg.forEach((e,t)=>{Unicorn.Load("peg"+t,`${o}/assets/${e}.png`)}):Unicorn.Load("peg",`${o}/assets/${a.peg}.png`),Array.isArray(a.star)?a.star.forEach((e,t)=>{Unicorn.Load("star"+t,`${o}/assets/${e}.png`)}):Unicorn.Load("star",`${o}/assets/${a.star}.png`),Object.keys(a.characters).forEach(e=>{for(let t=0;t<10;t++){let r=a.characters[e];Unicorn.Load(`${e}_${t}`,`${o}/assets/characters/${e}/${r}_front/${r}_front${t+1}.png`)}}),a.clouds.forEach(e=>Unicorn.Load(e,`${o}/assets/${e}.png`)),Unicorn.Load("sfx-peg-bounce",`${o}/assets/${a.peg_sound}`),Unicorn.Load("sfx-win",`${o}/assets/${a.win_sound}`);for(let e=0;e<4;e++){let t,o,l;e%2==0?(t=Math.floor(i/137),o=i/t,l=o,t--):(t=Math.floor((i-137)/137),t--,o=137,l=137+o/2);for(let i=0;i<t;i++){let t="peg";Array.isArray(a.peg)&&(t="peg"+(i+2*e)%a.peg.length);let c=Unicorn.AddObject(`peg_${e}-${i}`,{type:"circle",x:i*o+l,y:s-240-200*e,radius:27,scale:{x:3,y:3},sprite:t,isStatic:!0,density:1/0,friction:1,frictionStatic:.5,frictionAir:.01,onEnter:(e,t)=>{e.startsWith("player_")&&Unicorn.PlaySound("sfx-peg-bounce",{volume:n})}});c.sprite.alpha=r.overlay?.15:1,c.restitution=1.05,c.mass=1/0,c.inverseMass=0,z.push(c)}}if(!a.hideWalls){for(let e=0;e<4;e++){let t=Unicorn.AddObject(`wall_${e}`,{type:"rectangle",x:e*i/5+i/5-8,y:s-60,width:12,height:120,scale:{x:3,y:3},sprite:"wall",isStatic:!0});F.push(t)}a.wallfront&&(B=Unicorn.AddBacklay("wallfront","wallfront",0,s-1080),B.scale.x=i/1920*3,B.scale.y=3)}Unicorn.AddObject("bottom_detect",{type:"rectangle",x:i/2,y:s-2,width:i,height:2,isStatic:!0,isSensor:!0}).sprite.visible=!1;let t=Unicorn.AddObject("left_bound",{type:"rectangle",x:-100,y:s/2,width:200,height:s,isStatic:!0});t.restitution=1.05,t.mass=1/0,t.inverseMass=0,t.sprite.visible=!1;let l=Unicorn.AddObject("right_bound",{type:"rectangle",x:i+100,y:s/2,width:200,height:s,isStatic:!0});if(l.restitution=1.05,l.mass=1/0,l.inverseMass=0,l.sprite.visible=!1,Array.isArray(a.star)){W=0,R=[];for(let e=0;e<a.star.length;e++){let t=Unicorn.AddBacklay(`star${e}`,`star${e}`,i/2+(a.starXOffset||0),s-80+(a.starYOffset||0),{scale:{x:3,y:3}});t.anchor.set(.5),t.visible=!a.hideWalls,R.push(t)}R[W].visible=!0}else R=Unicorn.AddBacklay("star","star",i/2+(a.starXOffset||0),s-80+(a.starYOffset||0),{scale:{x:3,y:3}}),R.anchor.set(.5),R.visible=!a.hideWalls;Matter.Events.on(physics,"beforeUpdate",(function(e){for(var t in C)C[t].player&&Matter.Body.setVelocity(C[t].player,{x:Math.max(Math.min(C[t].player.velocity.x,30),-30),y:Math.max(Math.min(C[t].player.velocity.y,30),-30)})}))}function V(e,t){for(var r in C)C[r].player&&(C[r].isLanded,C[r].label.position.x=C[r].player.position.x,C[r].label.position.y=C[r].player.position.y-60,C[r].pet&&(C[r].pet.angle=C[r].player.angle,C[r].pet.position.x=Math.max(20,Math.min(i-20,C[r].player.position.x+C[r].petOffset)),C[r].pet.position.y=C[r].player.position.y+20));M.forEach((e,a)=>{e.x-=t*e.speed,e.x+e.width/2<=0&&(e.x=i+e.width/2,e.y=l(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)}),P.forEach(e=>{(e.vY<0||e.y<s-5)&&(e.x+=t/1e3*e.vX,e.y+=t/1e3*e.vY,e.vY<20&&(e.vY+=t/1e3*200))}),D>0&&Array.isArray(a.star)&&(J-=t,J<0&&(J+=60,R[W].visible=!1,W=(W+1)%R.length,R[W].visible=!0,a.target_animate_star_on_landed&&0===W&&D--))}