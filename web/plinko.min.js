let e="Pixel Plinko",t={},o={},n="",a=1920,i=1080,s=.5;function r(e){return Math.floor(Math.random()*Math.floor(e))}function l(){let t=Object.keys(m).length;fetch(`https://api.instafluff.tv:8082/report?game=${e}&channel=${o.channel}&players=${t}&persist=true`).then(e=>e.json()).then(e=>{0===e.status&&console.log("Error:",e.message)})}window.setupGame=function(r,l,c){e=r,t=l,o=c,n=t.path||"",o.clouds=void 0===o.clouds||null===o.clouds?!o.overlay:o.clouds,s=void 0===o.volume||null===o.volume?0:parseInt(o.volume)/100,a=Math.min(window.innerWidth,1920),i=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){Unicorn.Create("unicorn-display",{width:a,height:i,background:"transparent",init:w,update:E,channel:o.channel,username:o.oauth?o.channel:void 0,password:o.oauth,onCommand:d,onChat:p,wallTop:!1,wallBottom:!0,wallLeft:!0,wallRight:!0,gravity:{x:0,y:1}}),ComfyJS.onConnected=(e,n,i)=>{i&&(function(){if(o.clouds)for(let e=0;e<11;e++){c++;let e=t.clouds[r(t.clouds.length)],n=Unicorn.AddOverlay("cloud_"+c,e,r(a),r(500),{scale:{x:3,y:3}});n.alpha=o.overlay?.5:.9,n.anchor.set(.5),n.speed=.01+.1*Math.random(),n.zIndex=n.speed,g.push(n)}o.hideTilStart&&(g.forEach(e=>e.visible=!1),b.forEach(e=>e.sprite.visible=!1),x.forEach(e=>e.sprite.visible=!1),v.visible=!1)}(),setInterval(()=>{l()},6e4),l())}}},function(){const e=document.createElement("script");e.src=`${"https:"===document.location.protocol?"https":"http"}://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js`,e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();let c=0,f=!0;function d(e,n,a,i,s){if(!i.broadcaster&&!i.mod||"resetplinko"!==n&&"resetboing"!==n||location.reload(),(i.broadcaster||i.mod)&&"testplinko"===n)for(var l=0;l<50;l++)c++,$("test"+c,"test_"+c,s.userColor||"#ffffff",Object.keys(t.characters)[r(Object.keys(t.characters).length)]);if("plink"===n||"plinko"===n||"boing"===n||"boingboing"===n){f&&o.hideTilStart&&(f=!1,g.forEach(e=>e.visible=!0),b.forEach(e=>e.sprite.visible=!0),x.forEach(e=>e.sprite.visible=!0),v.visible=!0);const t=twemoji.parse(a,{assetType:"png"});!s.messageEmotes&&t.length>0?$(e,e,s.userColor||"#ffffff",a,"",t[0].url):$(e,e,s.userColor||"#ffffff",a,s.messageEmotes?Object.keys(s.messageEmotes)[0]:"")}}function p(e,t,o,n,a){}let h=null,m={},u={},y={},g=[],b=[],x=[],v=null;function $(e,n,i="#ffffff",l,c="",f=""){if(!m[e]){let g=null,b=tinycolor(i);if(c){if(!u[c]){u[c]=!0;var d=`https://static-cdn.jtvnw.net/emoticons/v1/${c}/2.0`;return Unicorn.Load(`emote_${c}`,d),void setTimeout(()=>{$(e,n,i,l,parachute,c)},500)}g=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:4/60,frames:[`emote_${c}`],loop:!0}},x:200+r(a-200),y:-100-r(50),z:100,radius:36}),g.endImage=`emote_${c}`,g.endScale=1.2}else if(f){if(!y[f])return y[f]=!0,Unicorn.Load(`emoji_${f}`,f),void setTimeout(()=>{$(e,n,i,l,parachute,c)},500);g=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:4/60,frames:[`emoji_${f}`],loop:!0}},x:200+r(a-200),y:-100-r(50),z:100,radius:36}),g.endImage=`emoji_${f}`,g.endScale=1}else if(t.characters[l]||(l=t.playable[Math.floor(t.playable.length*Math.random())]),g=Unicorn.AddObject("player_"+e,{type:"circle",scale:{x:3,y:3},animations:{front:{framerate:4/60,frames:[...Array(10).keys()].map(e=>`${l}_${e}`),loop:!0}},x:200+r(a-200),y:-100-r(50),z:100,radius:36,onEnter:(t,n)=>{if("bottom_detect"===t&&(m[e].isLanded=!0,g.isSensor=!0,g.isStatic=!0,1*a/5+a/5-8<g.position.x&&g.position.x<2*a/5+a/5-8&&(console.log("Winner: "+e),Unicorn.PlaySound("sfx-win",{volume:s}),o.messageFormat))){let t=o.messageFormat.replace("USERNAME",e);setTimeout(()=>{ComfyJS.Say(t)},5e3)}}}),g.endImage=`${l}_0`,g.endScale=3,"boybear"===l||"girlbear"===l){var p=PIXI.utils.string2hex(b.brighten(50).toHexString());g.animations.front.tint=p}let x=Unicorn.AddText("name_"+e,n,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:i,lineJoin:"round",stroke:b.getLuminance()<.6?"#ffffff":"#000000",strokeThickness:6});x.anchor.set(.5),g.rotationOffset=Math.random()*Math.PI,m[e]={player:g,label:x},h&&clearTimeout(h),h=setTimeout(()=>{location.reload()},9e4)}}function w(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${n}/assets/${t.bg}.png`),!o.overlay){var e=Unicorn.AddBacklay("map","map",0,i-1080);e.scale.x=3,e.scale.y=3}Unicorn.Load("wall",`${n}/assets/${t.wall}.png`),Unicorn.Load("peg",`${n}/assets/${t.peg}.png`),Unicorn.Load("star",`${n}/assets/${t.star}.png`),Object.keys(t.characters).forEach(e=>{for(let o=0;o<10;o++){let a=t.characters[e];Unicorn.Load(`${e}_${o}`,`${n}/assets/characters/${e}/${a}_front/${a}_front${o+1}.png`)}}),t.clouds.forEach(e=>Unicorn.Load(e,`${n}/assets/${e}.png`)),Unicorn.Load("sfx-peg-bounce",`${n}/assets/${t.peg_sound}`),Unicorn.Load("sfx-win",`${n}/assets/${t.win_sound}`);for(let e=0;e<4;e++){let t=Math.floor((a-100)/137),o=a/2-t/2*137+68.5;e%2>0&&(t-=1,o+=68.5);for(let n=0;n<t;n++){let t=Unicorn.AddObject(`peg_${e}-${n}`,{type:"circle",x:137*n+o,y:i-240-200*e,radius:27,scale:{x:3,y:3},sprite:"peg",isStatic:!0,density:1/0,friction:1,frictionStatic:.5,frictionAir:.01,onEnter:(e,t)=>{e.startsWith("player_")&&Unicorn.PlaySound("sfx-peg-bounce",{volume:s})}});t.restitution=1.05,t.mass=1/0,t.inverseMass=0,b.push(t)}}for(let e=0;e<4;e++){let t=Unicorn.AddObject(`wall_${e}`,{type:"rectangle",x:e*a/5+a/5-8,y:i-60,width:12,height:120,scale:{x:3,y:3},sprite:"wall",isStatic:!0});x.push(t)}Unicorn.AddObject("bottom_detect",{type:"rectangle",x:a/2,y:i-2,width:a,height:2,isStatic:!0,isSensor:!0}).visible=!1,v=Unicorn.AddBacklay("star","star",a/2,i-80,{scale:{x:3,y:3}}),v.anchor.set(.5),Matter.Events.on(physics,"beforeUpdate",(function(e){for(var t in m)Matter.Body.setVelocity(m[t].player,{x:Math.max(Math.min(m[t].player.velocity.x,30),-30),y:Math.max(Math.min(m[t].player.velocity.y,30),-30)})}))}function E(e,t){for(var o in m)m[o].isLanded,m[o].label.position.x=m[o].player.position.x,m[o].label.position.y=m[o].player.position.y-60;g.forEach((e,o)=>{e.x-=t*e.speed,e.x+e.width/2<=0&&(e.x=a+e.width/2,e.y=r(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)})}