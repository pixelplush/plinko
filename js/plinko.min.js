let e=0;function d(e,d,t,a=!1){let u={};return g.Animations.forEach(o=>{a&&"back"===o||(u[o]={numFrames:t,prefix:`${e}_${d}_${o}`})}),u}function t({x:e,y:d,z:t,radius:a,scale:u=3,name:o,framerate:n=4/60,animations:r,suffix:s=""}={}){let i={};return Object.keys(r).forEach(e=>{i[e]={framerate:n,frames:Array.from({length:r[e].numFrames},(d,t)=>`${r[e].prefix}${s||t}`),loop:!0}}),Unicorn.AddObject(o,{type:"circle",scale:{x:u,y:u},friction:0,frictionAir:0,frictionStatic:0,bounce:1,animations:i,x:e,y:d,z:t,radius:a})}function a({x:e,y:d,z:t,scale:a=3,name:u,framerate:o=4/60,animations:n,suffix:r=""}={}){let s={};Object.keys(n).forEach(e=>{s[e]={framerate:o,frames:Array.from({length:n[e].numFrames},(d,t)=>`${n[e].prefix}${r||t}`),loop:!0}});let i=Unicorn.AddSprite(u,{scale:{x:a,y:a},animations:s,x:e,y:d,z:t});return i.label=u,i.objectOffset=-39,Object.keys(n).forEach(e=>{i.animations[e].anchor.set(.5,1)}),i}function u(e){e.sprites&&Object.keys(e.sprites).forEach(d=>{Unicorn.RemoveSprite(e.sprites[d].label)}),Unicorn.RemoveObject(e.label)}function o(o,n,r,s={}){e++;const i="player_"+e;if(!c)throw"No GameTheme Defined";c.characters||(c.characters={});let f=g.NumFrames,l="",p={};const h=[];if(s.character){const e=s.character;_["char_"+e.id]||(c.characters[e.id]=e.path,T("char",e.id,"characters",c.characters[e.id],f)),p=t({x:o,y:n,z:r,radius:36,name:i,animations:d("char",e.id,f)});const u=Object.keys(p.animations);for(const e of u)p.animations[e].visible=!1;p.character=e.id,p.charName=i,p.endImage=`char_${e.id}_front0`,p.endScale=3,p.sprites={},p.sprites.char=a({x:o,y:n,z:r,name:i+"_char",animations:d("char",e.id,f),suffix:l}),Unicorn.AttachSpriteToObject(i+"_char",i),h.push(i+"_char")}else{if(s.wheelchairs){const e=s.wheelchairs;f=1,l="_wheel",T("wheelchair",e.path,"skins/equipment/wheelchairs",e.path,g.NumFrames)}if(!s.skintones)throw"No Body";{const e=s.skintones,u=s.expressions,c=s.hair;if(T("skin",e.path,"skins/body/skintones",e.path,f,l),p=t({x:o,y:n,z:r,radius:36,name:i,animations:d("skin",e.path,f),suffix:l}),p.character=e.path,p.charName=i,p.endImage=`skin_${e.path}_front0`,p.endScale=3,p.sprites={},u&&(T("expr",u.path,"skins/body/expressions",u.path,f,l,!0),p.sprites.expr=a({x:o,y:n,z:r+1,name:i+"_expr",animations:d("expr",u.path,f,!0),suffix:l}),Unicorn.AttachSpriteToObject(i+"_expr",i),h.push(i+"_expr")),c){s.onesies||(T("hair",c.path,"skins/body/hair",c.path,f,l),p.sprites.hair=a({x:o,y:n,z:r+2,name:i+"_hair",animations:d("hair",c.path,f),suffix:l}),Unicorn.AttachSpriteToObject(i+"_hair",i),h.push(i+"_hair"))}}if(s.wheelchairs){const e=s.wheelchairs;p.sprites.wheelchair=a({x:o,y:n,z:r+10,name:i+"_wheel",animations:d("wheelchair",e.path,g.NumFrames)}),Unicorn.AttachSpriteToObject(i+"_wheel",i),h.push(i+"_wheel")}}const m=s.pants,y=s.shirts,b=s.dresses,x=s.onesies;m&&(T("pants",m.path,"skins/outfits/pants",m.path,f,l),p.sprites.pants=a({x:o,y:n,z:r+3,name:i+"_pants",animations:d("pants",m.path,f),suffix:l}),Unicorn.AttachSpriteToObject(i+"_pants",i),h.push(i+"_pants")),y&&(T("shirts",y.path,"skins/outfits/shirts",y.path,f,l),p.sprites.shirts=a({x:o,y:n,z:r+4,name:i+"_shirts",animations:d("shirts",y.path,f),suffix:l}),Unicorn.AttachSpriteToObject(i+"_shirts",i),h.push(i+"_shirts")),b&&(T("dress",b.path,"skins/outfits/dresses",b.path,f,l),p.sprites.dresses=a({x:o,y:n,z:r+5,name:i+"_dresses",animations:d("dress",b.path,f),suffix:l}),Unicorn.AttachSpriteToObject(i+"_dresses",i),h.push(i+"_dresses")),x&&(T("onesie",x.path,"skins/outfits/onesies",x.path,f,l),p.sprites.onesies=a({x:o,y:n,z:r+5,name:i+"_onesies",animations:d("onesie",x.path,f),suffix:l}),Unicorn.AttachSpriteToObject(i+"_onesies",i),h.push(i+"_onesies"));const v=["glasses","hats","masks","wands"];for(const e of v){const t=s[e];t&&(T("acc",t.path,"skins/accessories/"+e,t.path,f,l),p.sprites["acc_"+t.path]=a({x:o,y:n,z:r+10,name:i+"_acc_"+t.path,animations:d("acc",t.path,f),suffix:l}),Unicorn.AttachSpriteToObject(i+"_acc_"+t.path,i),h.push(i+"_acc_"+t.path))}const S=s.effects;return S&&(T("effect",S.path,"skins/effects",S.path,f,l),p.sprites.effects=a({x:o,y:n,z:r+5,name:i+"_effects",animations:d("effect",S.path,f),suffix:l}),Unicorn.AttachSpriteToObject(i+"_effects",i),h.push(i+"_effects")),p.cleanup=()=>{u(p)},p}const n="https://api.pixelplush.dev/v1",r="https://stats.pixelplush.dev/v1";let s="PixelPlush Game",i="unknown",c={},f={},l="",p=1920,h=1080,m=.5,y=!1;const g={NumFrames:10,Animations:["front","left","back","right"]};let _={};var b="",x=!0;let v="",S=!0,k={};function w(e){return Math.floor(Math.random()*Math.floor(e))}function A(e){for(let d=e.length-1;d>0;d--){const t=Math.floor(Math.random()*(d+1));[e[d],e[t]]=[e[t],e[d]]}}async function $(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth "+e}}).then(e=>e.json()).catch(e=>({error:e}))}async function U(e){return await fetch("https://api.pixelplush.dev/v1/auth/refresh?token="+e).then(e=>e.json()).catch(e=>({error:e}))}function O(e,d,t,a,u){const o=a.dims;let n=document.createElement("canvas");n.width=d,n.height=t;let r=n.getContext("2d"),s=r.createImageData(d,t);if(u)for(let e=0;e<t;e++)for(let t=0;t<d;t++){const a=4*(e*d+t);s.data[a+0]=u.data[a+0],s.data[a+1]=u.data[a+1],s.data[a+2]=u.data[a+2],s.data[a+3]=u.data[a+3]}for(let e=o.top;e<o.top+o.height;e++)for(let t=o.left;t<o.left+o.width;t++){const u=t-o.left,n=(e-o.top)*o.width+u,r=4*n,i=4*(e*d+t);a.pixels[n]!==a.transparentIndex&&(s.data[i+0]=a.patch[r+0],s.data[i+1]=a.patch[r+1],s.data[i+2]=a.patch[r+2],s.data[i+3]=a.patch[r+3])}switch(r.putImageData(s,0,0),e){case 1:default:break;case 2:for(let e=o.top;e<o.top+o.height;e++)for(let t=o.left;t<o.left+o.width;t++){const a=4*(e*d+t);s.data[a+0]=0,s.data[a+1]=0,s.data[a+2]=0,s.data[a+3]=0}break;case 3:if(u)for(let e=o.top;e<o.top+o.height;e++)for(let t=o.left;t<o.left+o.width;t++){const a=4*(e*d+t);s.data[a+0]=u.data[a+0],s.data[a+1]=u.data[a+1],s.data[a+2]=u.data[a+2],s.data[a+3]=u.data[a+3]}}return{canvas:n,data:s}}async function j(e,d=!1){let t=Object.keys(le).length;return window.location.host.startsWith("localhost")?0:fetch(n+"/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:e?null:b,game:i,theme:s,channel:f.channel,players:Object.keys(le),count:t,finished:d})}).then(e=>e.json())}function T(e,d,t,a,u,o="",n=!1){if(!_[e+"_"+d+o]){_[e+"_"+d+o]=!0;for(let r=0;r<u;r++)for(let u=0;u<g.Animations.length;u++){const s=g.Animations[u];if(n&&"back"===s)continue;const i=`${a}_${s}`;o?Unicorn.Load(`${e}_${d}_${s}${o}`,`${l}/assets/${t}/${d}/${i}/${i}${o}.png`):Unicorn.Load(`${e}_${d}_${s}${r}`,`${l}/assets/${t}/${d}/${i}/${i}${r+1}.png`)}}}async function C(e,d,t,a,u){switch(d){case"report":{let d=null;if(f.oauth){let e=await $(f.oauth.replace("oauth:",""));e.user_id?(d="Valid",["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(d=>e.scopes.includes(d))||(d="Need more permissions"),e.expires_in<1800&&(d="Token expires soon. Need to generate new link")):d="Invalid or expired token"}else d="No OAuth Token Provided";!async function(e,d){window.location.host.startsWith("localhost")||fetch(n+"/events/debug",{method:"POST",headers:{},body:JSON.stringify({channel:f.channel,user:e,game:i,theme:s,info:d})}).then(e=>e.json())}(e,`OAuth Token Status: ${d}\n\nGame: ${s}\n\nType: ${i}\n\nAgent: ${navigator.userAgent}\n\nLanguage: ${navigator.language}\n\nOptions:\n   ${Object.keys(f).filter(e=>"oauth"!==e&&"refreshToken"!==e&&f[e]).map(e=>`${e}:${f[e]}`).join("\n   ")}\n`)}break;case"debug":if(y)Unicorn.RemoveText("pixelplush_debug"),y=!1;else{y=!0;let e=null;if(f.oauth){let d=await $(f.oauth.replace("oauth:",""));d.user_id?(e="Valid",["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(e=>d.scopes.includes(e))||(e="Need more permissions"),d.expires_in<1800&&(e="Token expires soon. Need to generate new link")):e="Invalid or expired token"}else e="No OAuth Token Provided";const d=`OAuth Token Status: ${e}\n\nGame: ${s}\n\nType: ${i}\n\nOptions:\n   ${Object.keys(f).filter(e=>"oauth"!==e&&"refreshToken"!==e&&f[e]).map(e=>`${e}:${f[e]}`).join("\n   ")}\n`;Unicorn.AddText("pixelplush_debug",d,50,50,{fontFamily:"Pixeltype",fontSize:32,fontWeight:400,fill:16711680,lineJoin:"round",stroke:"#ff0000",strokeThickness:1})}break;case"clearcache":localStorage.setItem("pixelplush_token",""),localStorage.setItem("pixelplush_refresh","");break;case"theme":if(t){const e=parachuteThemes[t];e&&(await I(e.name,e.theme,f,!0),Unicorn.ResetScene("main"))}}}let E=!1;async function I(e,d,t,a=!1){if(s=e,c=d,f=t,l=c.path||"",f.clouds=void 0===f.clouds||null===f.clouds?!f.overlay:"true"===f.clouds,m=void 0===f.volume||null===f.volume?0:parseInt(f.volume)/100,p=Math.min(window.innerWidth,c.screenWidth||1920),h=Math.min(window.innerHeight,c.screenHeight||1080),f.variations&&!f.didRandom){const e=f.variations.split(","),d=w(e.length),t=`${window.location.protocol}//${window.location.host}${window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))}/${e[d]}${window.location.search}&didRandom=1`;window.location.href=t}f.readyTime&&(S=!1,setTimeout(()=>{S=!0,ComfyJS.Say("Parachute Drop is ready!")},parseInt(f.readyTime||1e3)));try{const e=(await fetch("https://www.pixelplush.dev/assets/shamelist.txt").then(e=>e.text())).split(",").map(e=>e.trim().toLowerCase());if(f.channel&&e&&e.includes(f.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),x=!1),f.oauth&&(f.oauth=await async function(e,d){const t=localStorage.getItem("pixelplush_token"),a=localStorage.getItem("pixelplush_refresh");if(t){const e=await $(t);if(console.log("stored access token",e),e&&e.user_id&&e.scopes&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(d=>e.scopes.includes(d)))return t}if(a){const e=await U(a);if(console.log("stored refresh token",e),e&&e.access_token&&e.scope&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(d=>e.scope.includes(d)))return localStorage.setItem("pixelplush_token",e.access_token),localStorage.setItem("pixelplush_refresh",e.refresh_token),e.access_token}const u=await $(e);if(console.log("provided access token",u),u&&u.user_id&&u.scopes&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(e=>u.scopes.includes(e)))return localStorage.setItem("pixelplush_token",e),localStorage.setItem("pixelplush_refresh",d),e;if(d){const e=await U(d);if(console.log("provided refresh token",e),e&&e.access_token&&e.scope&&["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(d=>e.scope.includes(d)))return localStorage.setItem("pixelplush_token",e.access_token),localStorage.setItem("pixelplush_refresh",e.refresh_token),e.access_token}return console.log("no valid tokens"),null}(f.oauth.replace("oauth:",""),f.refreshToken)),c.requires)try{if(account=await fetch(r+"/accounts",{headers:{Twitch:f.oauth?f.oauth.replace("oauth:",""):void 0}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(c.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}if(await async function(){i="plinko",f.notifVolume&&(W=parseInt(f.notifVolume)/100);f.command=f.command||"plink",f.cpPlink&&(k["Plinko!"]={desc:"Drop into the PixelPlush Plinko Game!",color:"#F2C079",cost:parseInt(f.cpPlinkCost||50),callback:(e,d,t,a,u)=>{le[e]||Q(e,f.command,a,{},u)}});f.cpQueue&&(k["Group Plinko"]={desc:"Queue everyone for a group plinko in the PixelPlush Plinko Game!",color:"#F2C079",cost:parseInt(f.cpQueueCost||500),cooldown:parseInt(f.cpQueueCD||120),callback:()=>{if(S)if(x)if(V)ComfyJS.Say("/me Group Plinko is already queued.");else{W&&Unicorn.PlaySound("sfx-group-queue",{volume:W}),V=!0,ee();const e=6e4;ComfyJS.Say(`/me Plinkos are queued for the next 60 seconds. !${f.command||"plinko"} to join!`),setTimeout(()=>{ComfyJS.Say(`/me 30 seconds remaining. !${f.command||"plinko"} to join!`)},e-3e4),setTimeout(()=>{ComfyJS.Say("/me 10 seconds. !"+(f.command||"plinko"))},e-1e4),setTimeout(()=>{A(Y),Y.forEach(e=>{Oe(e.username,e.name,e.color,e.message,e.emote,e.emoji,e.extra)}),Y=[]},e)}else f.oauth&&ComfyJS.Say("The Plinko Bounce game needs your attention. Please contact the PixelPlush team on Discord.")}})}(),f.oauth){let e=await $(f.oauth.replace("oauth:",""));e.user_id?(E=!0,v=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every(d=>e.scopes.includes(d))||(console.log("Need more permissions"),console.log("Current scopes",e.scopes)),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")):(console.log("Invalid token"),E=!1)}}catch(e){console.log(e)}a||async function(){Unicorn.Create("unicorn-display",{width:p,height:h,background:"transparent",init:Te,update:Ce,channel:f.channel,username:f.channel,password:f.oauth&&E?f.oauth.replace("oauth:",""):void 0,onCommand:Q,onChat:H,screenWalls:!1,gravity:{x:0,y:1},framerate:f.fps||60,fonts:{custom:["Pixeltype"]}}),ComfyJS.onCheer=K,ComfyJS.onRaid=Z,ComfyJS.onConnected=async(e,d,t)=>{if(t){je();let e=await j(!0);0!==e&&(b=e.session,setInterval(()=>{j(!1)},3e5));let d=await ComfyJS.GetChannelRewards(v,!0),t=Object.keys(k);for(let e=0;e<t.length;e++){let a=t[e];if(!d.some(e=>e.title===a))try{await ComfyJS.CreateChannelReward(v,{title:a,prompt:k[a].desc,cost:k[a].cost,is_enabled:!0,background_color:k[a].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!!k[a].cooldown,global_cooldown_seconds:k[a].cooldown,should_redemptions_skip_request_queue:!0})}catch(e){console.log(e)}}}},ComfyJS.onReward=(e,d,t,a,u)=>{k[d]&&k[d].callback(e,d,t,a,u)}}()}window.setupGame=I;const P={parse:function(e,d){var t=d&&d.assetType?d.assetType:"svg",a=d&&d.buildUrl?d.buildUrl:function(e,d){return"png"===d?"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/"+e+".png":"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/"+e+".svg"},u=[];F.default.lastIndex=0;for(;;){var o=F.default.exec(e);if(!o)break;var n=o[0],r=J(R(n)).join("-");u.push({url:r?a(r,t):"",indices:[o.index,F.default.lastIndex],text:n,type:M})}return u}};P.toCodePoints=J;var L,F=(L=/(?:\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c\udffb|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c\udffb|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c\udffb|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb\udffc]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffd]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69])(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[Â©Â®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g)&&L.__esModule?L:{default:L};var M=P.TypeName="emoji";var N=/\uFE0F/g,z=String.fromCharCode(8205),R=function(e){return e.indexOf(z)<0?e.replace(N,""):e};function J(e){for(var d=[],t=0,a=0,u=0;u<e.length;)t=e.charCodeAt(u++),a?(d.push((65536+(a-55296<<10)+(t-56320)).toString(16)),a=0):t>55296&&t<=56319?a=t:d.push(t.toString(16));return d}let W=0,B=null,D=0;function q(e=0){if(B&&clearInterval(B),c.target_versions){Object.keys(ce).forEach(e=>{Array.isArray(oe)?ce[e].target.forEach(e=>{e.visible=!1}):ce[e].target.visible=!1,ce[e].target_overlay.forEach(e=>{e.visible=!1})});const e=w(Object.keys(ce).length);fe=Object.keys(ce)[e],oe=ce[fe].target,ne=ce[fe].target_overlay,Array.isArray(oe)?oe[se].visible=!0:oe.visible=!0,ne[ie].visible=!0}B=setInterval(()=>{Array.isArray(oe)&&(oe[se].visible=!1,se=(se+1)%oe.length,oe[se].visible=!0),ne&&Array.isArray(ne)&&(ne[ie].visible=!1,ie=(ie+1)%ne.length,ne[ie].visible=!0)},60),e>0&&(D=1e3*e)}let G=0,X=!0,Y=[],V=!1;async function Q(e,d,t,a,u){if((a.broadcaster||a.mod)&&"plinko"===d){const d=t.split(" ");C(e,d.shift(),d)}if(!a.broadcaster&&!a.mod||"resetplinko"!==d&&"resetboing"!==d||location.reload(),(a.broadcaster||a.mod)&&("deleteplinko"===d||"deleteboing"===d)){let e=await ComfyJS.GetChannelRewards(v,!0),d=Object.keys(k);for(let t=0;t<d.length;t++){let a=d[t],u=e.find(e=>e.title===a);u&&await ComfyJS.DeleteChannelReward(v,u.id)}}if((a.broadcaster||a.mod)&&"unqueueplinko"===d&&V&&(ComfyJS.Say("/me Group plinko is no longer queued."),V=!1),(a.broadcaster||a.mod)&&"queueplinko"===d&&(V?ComfyJS.Say("/me Group plinko is already queued."):(V=!0,ee(),ComfyJS.Say("/me Plinkos are queued this game. !startplinko to activate!"))),(a.broadcaster||a.mod)&&"startplinko"===d&&V&&(A(Y),Y.forEach(e=>{Oe(e.username,e.name,e.color,e.message,e.emote,e.emoji,e.extra)}),Y=[]),(a.broadcaster||a.mod)&&"testplinko"===d)for(var o=0;o<50;o++)G++,Oe("test"+G,"test_"+G,u.userColor||"#ffffff",Object.keys(c.characters)[w(Object.keys(c.characters).length)]);let n=!1;if(!f.commandOn&&f.cpPlink||(n=d===f.command||"plink"===f.command&&("plink"===d||"plinko"===d||"boing"===d||"boingboing"===d)),S)if(x){if(n){X&&f.hideTilStart&&(X=!1,me.forEach(e=>e.visible=!0),ge.forEach(e=>e.sprite.visible=!0),c.hideWalls||(_e.forEach(e=>e.sprite.visible=!0),Array.isArray(xe)?xe[ve].visible=!0:xe.visible=!0,be&&(be.visible=!0)),c.target&&(Array.isArray(oe)?(oe[se].visible=!0,c.target_animate_on_landed||q()):oe.visible=!0,Array.isArray(ne)?(ne[ie].visible=!0,c.target_animate_on_landed||q()):ne.visible=!0,re&&(re.visible=!0)));const d=P.parse(t,{assetType:"png"});!u.messageEmotes&&d.length>0?V?Y.push({username:u.username,name:e,color:u.userColor||"#ffffff",message:t,emote:"",emoji:d[0].url,extra:u}):Oe(u.username,e,u.userColor||"#ffffff",t,"",d[0].url):V?Y.push({username:u.username,name:e,color:u.userColor||"#ffffff",message:t,emote:u.messageEmotes?Object.keys(u.messageEmotes)[0]:"",emoji:"",extra:u}):Oe(u.username,e,u.userColor||"#ffffff",t,u.messageEmotes?Object.keys(u.messageEmotes)[0]:"")}}else n&&f.oauth&&ComfyJS.Say("The Plinko Bounce game needs your attention. Please contact the PixelPlush team on Discord.")}function H(e,d,t,a,u){}function K(e,d,t,a,u){if(!document.hidden&&S&&x&&d.startsWith("!")){let t=d.split(/ (.*)/);Q(e,t[0].slice(1).toLowerCase(),t[1]||"",a,u)}}function Z(e,d,t){document.hidden}function ee(){Object.keys(le).forEach(e=>{le[e].player.cleanup(),le[e].pet&&le[e].pet.cleanup(),Unicorn.RemoveText("name_"+e),delete le[e]}),de&&clearTimeout(de),je()}let de=null,te=368,ae=0,ue=0,oe=null,ne=null,re=null,se=0,ie=0,ce={},fe=null,le={},pe={},he={},me=[],ye=[],ge=[],_e=[],be=null,xe=null,ve=0,Se=0,ke=0,we=0;function Ae(e,d,t,a,u,o=""){we++;let n=Math.min(Math.max(1,u),100);Unicorn.AddParticles("Splash_"+we,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"cone",angle:-Math.PI/2,spread:Math.PI/2,startColor:e,endColor:d,intensity:n,minSpeed:.05,maxSpeed:.25,gravityX:0,gravityY:3.5,fadeOut:!0,decay:1,image:o||void 0},t,a),function(e,d=2e3){setTimeout(()=>{Unicorn.RemoveParticles(e)},d)}("Splash_"+we,150)}function $e(e,d,t,a=""){const u=c.target_boosh_scale||2;c.target_boosh.forEach((t,a)=>{for(let t=0;t<w(5);t++){we++;let a=Unicorn.AddBacklay("boosh_"+we,"target_boosh"+t,e,d+10,{scale:{x:u,y:u}});a.zIndex=11,a.vX=w(50)-25,a.vY=-350+w(100),a.anchor.set(.5),ye.push(a)}})}function Ue(e,d,t,a=""){const u=c.target_splash_scale||2;c.target_splash.forEach((t,a)=>{for(let t=0;t<w(5);t++){we++;let a=Unicorn.AddBacklay("splash_"+we,"target_splash"+t,e,d+10,{scale:{x:u,y:u}});a.zIndex=11,a.vX=w(100)-50,a.vY=-300+w(100),a.anchor.set(.5),splashes.push(a)}})}async function Oe(a,n,s="#ffffff",i,l="",h=""){let y=4/60;if(!le[a]){le[a]={};let x=null,v=null,S=null,k=tinycolor(s),A=await async function(e){let d={};try{if(!e)return d;let t=await fetch(`${r}/accounts/twitch/design?username=${e}`).then(e=>e.json());return t&&(d=t.style||{}),d}catch(e){console.log(e)}}(a);if(l){if(!pe[l]){if(pe[l]=!0,l.startsWith("emotesv2_")){let e=`https://static-cdn.jtvnw.net/emoticons/v2/${l}/default/dark/2.0`,d=await fetchGif(e);if(d.length>0){const e=function(e,d){const t=Math.min(...e.map(e=>e.delay)),a=Math.max(...e.map(e=>e.dims.width)),u=Math.max(...e.map(e=>e.dims.height));let o=0,n=null;for(let r=0;r<e.length;r++){const s=O(e[r].disposalType,a,u,e[r],n);n=s.data;for(let n=0;n<e[r].delay;n+=t)Unicorn.LoadCustom(`${d}${o}`,s.canvas,"texture",{width:a,height:u}),o++}return{frames:o,minDelay:t,width:a,height:u}}(d,"emote_"+l);pe[l]={frames:e.frames,framerate:1/60*(1e3/e.minDelay)},setTimeout(()=>{delete le[a],Oe(a,n,s,i,l,h)},500)}else Unicorn.Load(`emote_${l}0`,e),setTimeout(()=>{delete le[a],Oe(a,n,s,i,l,h)},500)}else{let e=`https://static-cdn.jtvnw.net/emoticons/v1/${l}/2.0`;Unicorn.Load(`emote_${l}0`,e),setTimeout(()=>{delete le[a],Oe(a,n,s,i,l,h)},500)}return}let e=[];if(l.startsWith("emotesv2_")&&"boolean"!=typeof pe[l]){y=pe[l].framerate;for(let d=0;d<pe[l].frames;d++)e.push(`emote_${l}${d}`)}else e=[`emote_${l}0`];x=Unicorn.AddObject("player_"+a,{type:"circle",scale:{x:1.2,y:1.2},animations:{front:{framerate:y,frames:e,loop:!0}},x:200+w(p-400),y:-100-w(50),z:100,radius:36,onCollide:(e,d,t)=>{if("TargetTop"===e){if(le[a].isLanded=!0,x.collisionFilter.category=1,x.isSensor=!0,x.isStatic=!0,c.target_versions&&q(),c.target_effect){G++;const e="te_"+G;let d=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:c.target_effect.length},(e,d)=>"target_effect"+d),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:le[a].player.position.x,y:le[a].player.position.y,z:200,radius:.1});d.isSensor=!0,d.animations.front.anchor.y=1}if(fe&&c.target_versions[fe].target_effect){G++;const e="te_"+G;let d=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:c.target_versions[fe].target_effect.length},(e,d)=>`target_effect${fe}${d}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:le[a].player.position.x,y:le[a].player.position.y,z:200,radius:.1});d.isSensor=!0,d.animations.front.anchor.y=1}if(c.target_animate_on_landed&&q(2),c.target_particles&&Ae(c.target_particles[0],c.target_particles[1],le[a].player.position.x,le[a].player.position.y+40,10),c.target_boosh&&$e(le[a].player.position.x,le[a].player.position.y+40),c.target_splash&&Ue(le[a].player.position.x,le[a].player.position.y+40),console.log("Winner: "+a),Unicorn.PlaySound("sfx-win",{volume:m}),f.messageFormat){let e=f.messageFormat.replace("USERNAME",a);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}else if("bottom_detect"===e&&(le[a].isLanded=!0,x.collisionFilter.category=1,x.isSensor=!0,x.isStatic=!0,c.target_boosh&&$e(le[a].player.position.x,le[a].player.position.y+40),1*p/5+p/5-8<x.position.x&&x.position.x<2*p/5+p/5-8&&(console.log("Winner: "+a),Unicorn.PlaySound("sfx-win",{volume:m}),c.target_animate_star_on_landed&&ke++,f.messageFormat))){let e=f.messageFormat.replace("USERNAME",a);setTimeout(()=>{ComfyJS.Say(e)},5e3)}},onEnter:(e,d)=>{if("bottom_detect"===e&&(le[a].isLanded=!0,x.collisionFilter.category=1,x.isSensor=!0,x.isStatic=!0,c.target_boosh&&$e(le[a].player.position.x,le[a].player.position.y+40),1*p/5+p/5-8<x.position.x&&x.position.x<2*p/5+p/5-8&&(console.log("Winner: "+a),Unicorn.PlaySound("sfx-win",{volume:m}),c.target_animate_star_on_landed&&ke++,f.messageFormat))){let e=f.messageFormat.replace("USERNAME",a);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}}),x.charName="player_"+a,x.endImage="emote_"+l,x.endScale=1.2,x.cleanup=()=>{u(x)}}else if(h){if(!he[h])return he[h]=!0,Unicorn.Load("emoji_"+h,h),void setTimeout(()=>{delete le[a],Oe(a,n,s,i,l,h)},500);x=Unicorn.AddObject("player_"+a,{type:"circle",scale:{x:1,y:1},animations:{front:{framerate:y,frames:["emoji_"+h],loop:!0}},x:200+w(p-400),y:-100-w(50),z:100,radius:36,onCollide:(e,d,t)=>{if("TargetTop"===e){if(le[a].isLanded=!0,x.collisionFilter.category=1,x.isSensor=!0,x.isStatic=!0,c.target_versions&&q(),c.target_effect){G++;const e="te_"+G;let d=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:c.target_effect.length},(e,d)=>"target_effect"+d),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:le[a].player.position.x,y:le[a].player.position.y,z:200,radius:.1});d.isSensor=!0,d.animations.front.anchor.y=1}if(fe&&c.target_versions[fe].target_effect){G++;const e="te_"+G;let d=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:c.target_versions[fe].target_effect.length},(e,d)=>`target_effect${fe}${d}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:le[a].player.position.x,y:le[a].player.position.y,z:200,radius:.1});d.isSensor=!0,d.animations.front.anchor.y=1}if(c.target_animate_on_landed&&q(2),c.target_particles&&Ae(c.target_particles[0],c.target_particles[1],le[a].player.position.x,le[a].player.position.y+40,10),c.target_boosh&&$e(le[a].player.position.x,le[a].player.position.y+40),c.target_splash&&Ue(le[a].player.position.x,le[a].player.position.y+40),console.log("Winner: "+a),Unicorn.PlaySound("sfx-win",{volume:m}),f.messageFormat){let e=f.messageFormat.replace("USERNAME",a);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}else if("bottom_detect"===e&&(le[a].isLanded=!0,x.collisionFilter.category=1,x.isSensor=!0,x.isStatic=!0,c.target_boosh&&$e(le[a].player.position.x,le[a].player.position.y+40),1*p/5+p/5-8<x.position.x&&x.position.x<2*p/5+p/5-8&&(console.log("Winner: "+a),Unicorn.PlaySound("sfx-win",{volume:m}),c.target_animate_star_on_landed&&ke++,f.messageFormat))){let e=f.messageFormat.replace("USERNAME",a);setTimeout(()=>{ComfyJS.Say(e)},5e3)}},onEnter:(e,d)=>{if("bottom_detect"===e&&(le[a].isLanded=!0,x.collisionFilter.category=1,x.isSensor=!0,x.isStatic=!0,c.target_boosh&&$e(le[a].player.position.x,le[a].player.position.y+40),1*p/5+p/5-8<x.position.x&&x.position.x<2*p/5+p/5-8&&(console.log("Winner: "+a),Unicorn.PlaySound("sfx-win",{volume:m}),c.target_animate_star_on_landed&&ke++,f.messageFormat))){let e=f.messageFormat.replace("USERNAME",a);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}}),x.charName="player_"+a,x.endImage="emoji_"+h,x.endScale=1,x.cleanup=()=>{u(x)}}else"string"!=typeof i?x=o(w(p),-100-w(50),100,i):A.skintones||A.character?(A.skintones&&delete A.character,x=o(w(p),-100-w(50),100,A)):x=function(a,u,o,n,r=null){c.playable,e++;const s="player_"+e;if(!c)throw"No GameTheme Defined";c.characters||(c.characters={});let i=!1;r&&c.playable.includes(r)||(n.character&&n.character.id?(r=n.character.id,i=!0):r=c.playable[w(c.playable.length)]),_["char_"+r]||(c.characters[r]||(c.characters[r]=i?n.character.path:r),T("char",r,"characters",c.characters[r],g.NumFrames));let f=t({x:a,y:u,z:o,radius:36,name:s,animations:d("char",r,g.NumFrames)});return f.character=r,f.charName=s,f.endImage=`char_${r}_front0`,f.endScale=3,f.cleanup=()=>{Unicorn.RemoveObject(s)},f}(w(p),-100-w(50),100,A,i),x.onCollide=(e,d,t)=>{if("TargetTop"===e){if(le[a].isLanded=!0,x.collisionFilter.category=1,x.isSensor=!0,x.isStatic=!0,c.target_versions&&q(),c.target_effect){G++;const e="te_"+G;let d=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:c.target_effect.length},(e,d)=>"target_effect"+d),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:le[a].player.position.x,y:le[a].player.position.y,z:200,radius:.1});d.isSensor=!0,d.animations.front.anchor.y=1}if(fe&&c.target_versions[fe].target_effect){G++;const e="te_"+G;let d=Unicorn.AddObject(e,{type:"circle",scale:{x:2,y:2},animations:{front:{framerate:4/60,frames:Array.from({length:c.target_versions[fe].target_effect.length},(e,d)=>`target_effect${fe}${d}`),loop:!1,onComplete:()=>{Unicorn.RemoveObject(e)}}},isSensor:!0,isStatic:!0,x:le[a].player.position.x,y:le[a].player.position.y,z:200,radius:.1});d.isSensor=!0,d.animations.front.anchor.y=1}if(c.target_animate_on_landed&&q(2),c.target_particles&&Ae(c.target_particles[0],c.target_particles[1],le[a].player.position.x,le[a].player.position.y+40,10),c.target_boosh&&$e(le[a].player.position.x,le[a].player.position.y+40),c.target_splash&&Ue(le[a].player.position.x,le[a].player.position.y+40),console.log("Winner: "+a),Unicorn.PlaySound("sfx-win",{volume:m}),f.messageFormat){let e=f.messageFormat.replace("USERNAME",a);setTimeout(()=>{ComfyJS.Say(e)},5e3)}}else if("bottom_detect"===e&&(le[a].isLanded=!0,x.collisionFilter.category=1,x.isSensor=!0,x.isStatic=!0,c.target_boosh&&$e(le[a].player.position.x,le[a].player.position.y+40),1*p/5+p/5-8<x.position.x&&x.position.x<2*p/5+p/5-8&&(console.log("Winner: "+a),Unicorn.PlaySound("sfx-win",{volume:m}),c.target_animate_star_on_landed&&ke++,f.messageFormat))){let e=f.messageFormat.replace("USERNAME",a);setTimeout(()=>{ComfyJS.Say(e)},5e3)}},detectEnter[x.charName]=(e,d)=>{if("bottom_detect"===e&&(le[a].isLanded=!0,x.collisionFilter.category=1,x.isSensor=!0,x.isStatic=!0,c.target_boosh&&$e(le[a].player.position.x,le[a].player.position.y+40),1*p/5+p/5-8<x.position.x&&x.position.x<2*p/5+p/5-8&&(console.log("Winner: "+a),Unicorn.PlaySound("sfx-win",{volume:m}),c.target_animate_star_on_landed&&ke++,f.messageFormat))){let e=f.messageFormat.replace("USERNAME",a);setTimeout(()=>{ComfyJS.Say(e)},5e3)}};S=function(a,u,o,n,r){if(!n||!n.pet||"pet_none"===n.pet.id)return null;e++;const s="pet_"+e;if(!c)throw"No GameTheme Defined";c.pets||(c.pets={});let i=n.pet.id.replace("pet_","");_["pet_"+i]||(c.pets[i]={path:n.pet.path,minIdle:n.pet.minIdle,maxIdle:n.pet.maxIdle},T("pet",i,"pets",n.pet.path,g.NumFrames));let f=t({x:a,y:u,z:o,radius:24,name:s,framerate:r||4/60,animations:d("pet",c.pets[i].path,g.NumFrames)});return f.isStatic=!0,f.isSensor=!0,f.petName=i,f.charName=s,f.cleanup=()=>{Unicorn.RemoveObject(s)},f}(-1e3,-1e3,200,A),S&&(v=S.petName);let $=Unicorn.AddText("name_"+a,n,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:34,fontWeight:400,fill:s,lineJoin:"round",stroke:tinycolor.isReadable(k.toString(),"#000000")?"#000000":"#ffffff",strokeThickness:6});$.anchor.set(.5),x.rotationOffset=Math.random()*Math.PI,le[a]={player:x,label:$,pet:S,petType:v,petOffset:50*Math.random()-25},de&&clearTimeout(de),de=setTimeout(async()=>{await j(!1,!0),ee(),j(!0).then(e=>{b=e.session})},parseInt(f.cooldown||9e4))}}function je(){if(X=!0,Y={},V=!1,te=c.target_width||368,ae=p/2,ue=h-47+(c.target_offset||0),c.target_walls&&(ae<te/2+70?ae=te/2+70:ae>p-te/2-70&&(ae=p-te/2-70)),c.target_versions){const e=w(Object.keys(c.target_versions).length);Object.keys(c.target_versions).forEach((d,t)=>{e===t&&(fe=d);let a=c.target_versions[d];if(ce[d]={},Array.isArray(a.target))if(c.target_random){let e=w(a.target.length);oe=Unicorn.AddBacklay("target"+d+e,"target"+d+e,ae,ue,{scale:{x:2,y:2}}),oe.zIndex=10,oe.anchor.set(.5),oe.visible=!1,ce[d].target=oe}else{se=0,oe=[];for(let e=0;e<a.target.length;e++){let t=Unicorn.AddBacklay("target"+d+e,"target"+d+e,ae,ue,{scale:{x:2,y:2}});t.zIndex=10,t.anchor.set(.5),t.visible=!1,oe.push(t)}ce[d].target=oe,oe[se].visible=!1,f.hideTilStart||c.target_animate_on_landed||q()}else oe=Unicorn.AddBacklay("target"+d,"target"+d,ae,ue,{scale:{x:2,y:2}}),oe.zIndex=10,oe.anchor.set(.5),oe.visible=!1,ce[d].target=oe;if(a.target_overlay)if(Array.isArray(a.target_overlay)){ie=0,ne=[];for(let e=0;e<a.target_overlay.length;e++){let t=Unicorn.AddBacklay("target_overlay"+d+e,"target_overlay"+d+e,ae,ue,{scale:{x:2,y:2}});t.zIndex=11,t.anchor.set(.5),t.visible=!1,ne.push(t)}ce[d].target_overlay=ne,ne[ie].visible=!1,f.hideTilStart||c.target_animate_on_landed||q()}else ne=Unicorn.AddBacklay("target_overlay"+d,"target_overlay"+d,ae,ue,{scale:{x:2,y:2}}),ne.zIndex=11,ne.anchor.set(.5),ne.visible=!1,ce[d].target_overlay=ne})}else if(c.target){if(Array.isArray(c.target))if(c.target_random){let e=w(c.target.length);oe=Unicorn.AddBacklay("target"+e,"target"+e,ae,ue,{scale:{x:2,y:2}}),oe.zIndex=10,oe.anchor.set(.5)}else{se=0,oe=[];for(let e=0;e<c.target.length;e++){let d=Unicorn.AddBacklay("target"+e,"target"+e,ae,ue,{scale:{x:2,y:2}});d.zIndex=10,d.anchor.set(.5),d.visible=!1,oe.push(d)}oe[se].visible=!0,f.hideTilStart||c.target_animate_on_landed||q()}else oe=Unicorn.AddBacklay("target","target",ae,ue,{scale:{x:2,y:2}}),oe.zIndex=10,oe.anchor.set(.5);if(c.target_overlay)if(Array.isArray(c.target_overlay)){ie=0,ne=[];for(let e=0;e<c.target_overlay.length;e++){let d=Unicorn.AddBacklay("target_overlay"+e,"target_overlay"+e,ae,ue,{scale:{x:2,y:2}});d.zIndex=11,d.anchor.set(.5),d.visible=!1,ne.push(d)}ne[ie].visible=!0,f.hideTilStart||c.target_animate_on_landed||q()}else ne=Unicorn.AddBacklay("target_overlay","target_overlay",ae,ue,{scale:{x:2,y:2}}),ne.zIndex=11,ne.anchor.set(.5)}if(c.target_front&&(re=Unicorn.AddOverlay("target_front","target_front",ae,ue,{scale:{x:2,y:2}}),re.anchor.set(.5)),f.clouds)for(let e=0;e<11;e++){G++;let e=c.clouds[w(c.clouds.length)],d=Unicorn.AddOverlay("cloud_"+G,e,w(p),w(500),{scale:{x:3,y:3}});d.alpha=f.overlay?.5:.9,d.anchor.set(.5),d.speed=.01+.1*Math.random(),d.zIndex=d.speed,me.push(d)}f.hideTilStart&&(me.forEach(e=>e.visible=!1),ge.forEach(e=>e.sprite.visible=!1),_e.forEach(e=>e.sprite.visible=!1),Array.isArray(xe)?xe.forEach(e=>e.visible=!1):xe.visible=!1,be&&(be.visible=!1)),c.target_walls&&(Unicorn.AddObject("TargetTop",{type:"rectangle",x:ae,y:ue+c.target_walls/2+c.target_collide_land,width:te-50,height:10,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("TargetLeft",{type:"rectangle",x:ae-te/2+27,y:ue+c.target_walls,width:10,height:100,isStatic:!0}).sprite.visible=!1,Unicorn.AddObject("TargetRight",{type:"rectangle",x:ae+te/2-27,y:ue+c.target_walls,width:10,height:100,isStatic:!0}).sprite.visible=!1)}function Te(e){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,Unicorn.Load("map",`${l}/assets/${c.bg}.png`),!f.overlay){var d=Unicorn.AddBacklay("map","map",0,h-1080);d.scale.x=3,d.scale.y=3}if(c.target_versions)Object.keys(c.target_versions).forEach(e=>{let d=c.target_versions[e];if(Array.isArray(d.target)){d.target.map((d,t)=>Unicorn.Load("target"+e+t,`${l}/assets/${d}.png`))}else{Unicorn.Load("target"+e,`${l}/assets/${d.target}.png`)}if(Array.isArray(d.target_overlay)){d.target_overlay.map((d,t)=>Unicorn.Load("target_overlay"+e+t,`${l}/assets/${d}.png`))}else{Unicorn.Load("target_overlay"+e,`${l}/assets/${d.target_overlay}.png`)}if(d.target_effect){d.target_effect.map((d,t)=>Unicorn.Load("target_effect"+e+t,`${l}/assets/${d}.png`))}});else if(c.target){if(Array.isArray(c.target)){c.target.map((e,d)=>Unicorn.Load("target"+d,`${l}/assets/${e}.png`))}else{Unicorn.Load("target",`${l}/assets/${c.target}.png`)}if(Array.isArray(c.target_overlay)){c.target_overlay.map((e,d)=>Unicorn.Load("target_overlay"+d,`${l}/assets/${e}.png`))}else{Unicorn.Load("target_overlay",`${l}/assets/${c.target_overlay}.png`)}if(c.target_effect){c.target_effect.map((e,d)=>Unicorn.Load("target_effect"+d,`${l}/assets/${e}.png`))}}c.target_front&&Unicorn.Load("target_front",`${l}/assets/${c.target_front}.png`),c.target_boosh&&c.target_boosh.forEach((e,d)=>{Unicorn.Load("target_boosh"+d,`${l}/assets/${e}.png`)}),c.target_splash&&c.target_splash.forEach((e,d)=>{Unicorn.Load("target_splash"+d,`${l}/assets/${e}.png`)}),c.wall&&Unicorn.Load("wall",`${l}/assets/${c.wall}.png`),c.wallfront&&Unicorn.Load("wallfront",`${l}/assets/${c.wallfront}.png`),Array.isArray(c.peg)?c.peg.forEach((e,d)=>{Unicorn.Load("peg"+d,`${l}/assets/${e}.png`)}):Unicorn.Load("peg",`${l}/assets/${c.peg}.png`),Array.isArray(c.star)?c.star.forEach((e,d)=>{Unicorn.Load("star"+d,`${l}/assets/${e}.png`)}):Unicorn.Load("star",`${l}/assets/${c.star}.png`),Object.keys(c.characters).forEach(e=>{T(e,"characters",c.characters[e],g.NumFrames)}),c.clouds.forEach(e=>Unicorn.Load(e,`${l}/assets/${e}.png`)),f.notifVolume&&Unicorn.Load("sfx-group-queue",`${l}/assets/${c.queue_sound}`),Unicorn.Load("sfx-peg-bounce",`${l}/assets/${c.peg_sound}`),Unicorn.Load("sfx-win",`${l}/assets/${c.win_sound}`);for(let e=0;e<4;e++){let d,t,a;e%2==0?(d=Math.floor(p/137),t=p/d,a=t,d--):(d=Math.floor((p-137)/137),d--,t=137,a=137+t/2);for(let u=0;u<d;u++){let d="peg";Array.isArray(c.peg)&&(d="peg"+(u+2*e)%c.peg.length);let o=Unicorn.AddObject(`peg_${e}-${u}`,{type:"circle",x:u*t+a,y:h-240-200*e,radius:27,scale:{x:3,y:3},sprite:d,isStatic:!0,density:1/0,friction:1,frictionStatic:.5,frictionAir:.01,onEnter:(e,d)=>{e.startsWith("player_")&&Unicorn.PlaySound("sfx-peg-bounce",{volume:m})}});o.sprite.alpha=f.overlay?parseFloat(f.pegOpacity||.15):1,o.restitution=1.05,o.mass=1/0,o.inverseMass=0,ge.push(o)}}if(!c.hideWalls){for(let e=0;e<4;e++){let d=Unicorn.AddObject("wall_"+e,{type:"rectangle",x:e*p/5+p/5-8,y:h-60,width:12,height:120,scale:{x:3,y:3},sprite:"wall",isStatic:!0});_e.push(d)}c.wallfront&&(be=Unicorn.AddBacklay("wallfront","wallfront",0,h-1080),be.scale.x=p/1920*3,be.scale.y=3)}Unicorn.AddObject("bottom_detect",{type:"rectangle",x:p/2,y:h-2,width:p,height:2,isDetector:!0,isStatic:!0,isSensor:!0});let t=Unicorn.AddObject("left_bound",{type:"rectangle",x:-100,y:h/2,width:200,height:h,isStatic:!0});t.restitution=1.05,t.mass=1/0,t.inverseMass=0,t.sprite.visible=!1;let a=Unicorn.AddObject("right_bound",{type:"rectangle",x:p+100,y:h/2,width:200,height:h,isStatic:!0});if(a.restitution=1.05,a.mass=1/0,a.inverseMass=0,a.sprite.visible=!1,Array.isArray(c.star)){ve=0,xe=[];for(let e=0;e<c.star.length;e++){let d=Unicorn.AddBacklay("star"+e,"star"+e,p/2+(c.starXOffset||0),h-80+(c.starYOffset||0),{scale:{x:3,y:3}});d.anchor.set(.5),d.visible=!c.hideWalls,xe.push(d)}for(let e=0;e<c.star.length;e++)xe[e].visible=!1;xe[ve].visible=!0}else xe=Unicorn.AddBacklay("star","star",p/2+(c.starXOffset||0),h-80+(c.starYOffset||0),{scale:{x:3,y:3}}),xe.anchor.set(.5),xe.visible=!c.hideWalls;Matter.Events.on(e.physics,"beforeUpdate",(function(e){for(var d in le)le[d].player&&Matter.Body.setVelocity(le[d].player,{x:Math.max(Math.min(le[d].player.velocity.x,30),-30),y:Math.max(Math.min(le[d].player.velocity.y,30),-30)})}))}function Ce(e,d){for(let e in le)le[e].player&&(le[e].isLanded,le[e].label.position.x=le[e].player.position.x,le[e].label.position.y=le[e].player.position.y-60,le[e].pet&&(le[e].pet.angle=le[e].player.angle,le[e].pet.position.x=Math.max(20,Math.min(p-20,le[e].player.position.x+le[e].petOffset)),le[e].pet.position.y=le[e].player.position.y+20));me.forEach((e,t)=>{e.x-=d*e.speed,e.x+e.width/2<=0&&(e.x=p+e.width/2,e.y=w(500),e.speed=.01+.1*Math.random(),e.zIndex=e.speed)}),ye.forEach(e=>{(e.vY<0||e.y<h-5)&&(e.x+=d/1e3*e.vX,e.y+=d/1e3*e.vY,e.vY<20&&(e.vY+=d/1e3*200))}),ke>0&&Array.isArray(c.star)&&(Se-=d,Se<=0&&(Se+=60,xe[ve].visible=!1,ve=(ve+1)%xe.length,xe[ve].visible=!0,c.target_animate_star_on_landed&&0===ve&&ke--))}